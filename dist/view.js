"use strict";function gup(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e="[\\?&]"+t+"=([^&#]*)",i=new RegExp(e),a=i.exec(window.location.href);return null===a?"":a[1]}window.build={},build.iconic=function(t,e){var i="";return e=e||"",i="\n\t\t\t<svg class='iconic "+e+"'>\n\t\t\t\t<use xlink:href='#"+t+"' />\n\t\t\t</svg>\n\t\t\t"},build.divider=function(t){var e="";return e="\n\t\t\t<div class='divider'>\n\t\t\t\t<h1>"+t+"</h1>\n\t\t\t</div>\n\t\t\t"},build.editIcon=function(t){var e="";return e="<div id='"+t+"' class='edit'>"+build.iconic("pencil")+"</div>"},build.multiselect=function(t,e){var i="";return i="<div id='multiselect' style='top: "+t+"px; left: "+e+"px;'></div>"},build.album=function(t){if(null===t||void 0===t)return"";var e="",i=lychee.retinize(t.thumbs[0]),a=i.path,n=i.hasRetina;return e="\n\t\t\t<div class='album' data-id='"+t.id+"'>\n\t\t\t\t<img src='"+t.thumbs[2]+"' width='200' height='200' alt='thumb' data-retina='false'>\n\t\t\t\t<img src='"+t.thumbs[1]+"' width='200' height='200' alt='thumb' data-retina='false'>\n\t\t\t\t<img src='"+a+"' width='200' height='200' alt='thumb' data-retina='"+n+"'>\n\t\t\t\t<div class='overlay'>\n\t\t\t\t\t<h1 title='"+t.title+"'>"+t.title+"</h1>\n\t\t\t\t\t<a>"+t.sysdate+"</a>\n\t\t\t\t</div>\n\t\t\t",lychee.publicMode===!1&&("1"===t.star&&(e+="<a class='badge icn-star'>"+build.iconic("star")+"</a>"),"1"===t["public"]&&(e+="<a class='badge icn-share'>"+build.iconic("eye")+"</a>"),"1"===t.unsorted&&(e+="<a class='badge'>"+build.iconic("list")+"</a>"),"1"===t.recent&&(e+="<a class='badge'>"+build.iconic("clock")+"</a>"),"1"===t.password&&(e+="<a class='badge'>"+build.iconic("lock-locked")+"</a>")),e+="</div>"},build.photo=function(t){if(null===t||void 0===t)return"";var e="",i=lychee.retinize(t.thumbUrl),a=i.path;i.hasRetina;return console.log(t),e="\n\t\t\t<div class='photo' data-album-id='"+t.album+"' data-id='"+t.id+"'>\n\t\t\t\t<img src='"+a+"' width='200' height='200' alt='thumb'>\n\t\t\t\t<div class='overlay'>\n\t\t\t\t\t<h1 title='"+t.title+"'>"+t.title+"</h1>\n\t\t\t",e+="1"===t.cameraDate?"<a><span title='Camera Date'>"+build.iconic("camera-slr")+"</span>"+t.sysdate+"</a>":"<a>"+t.sysdate+"</a>",e+="</div>",lychee.publicMode===!1&&("1"===t.star&&(e+="<a class='badge iconic-star'>"+build.iconic("star")+"</a>"),"1"===t["public"]&&"1"!==album.json["public"]&&(e+="<a class='badge iconic-share'>"+build.iconic("eye")+"</a>")),e+="</div>"},build.imageview=function(t,e,i){if(null===t||void 0===t)return"";var a="";return a="\n\t\t\t<div class='arrow_wrapper arrow_wrapper--previous'><a id='previous'>"+build.iconic("caret-left")+"</a></div>\n\t\t\t<div class='arrow_wrapper arrow_wrapper--next'><a id='next'>"+build.iconic("caret-right")+"</a></div>\n\t\t\t","big"===e?a+=i===!0?"<div id='image' style='background-image: url("+t.url+")'></div>":"<div id='image' style='background-image: url("+t.url+");' class='full'></div>":"medium"===e?a+=i===!0?"<div id='image' style='background-image: url("+t.medium+")'></div>":"<div id='image' style='background-image: url("+t.medium+");' class='full'></div>":"small"===e&&(a+=i===!0?"<div id='image' class='small' style='background-image: url("+t.url+"); width: "+t.width+"px; height: "+t.height+"px; margin-top: -"+parseInt(t.height/2-20)+"px; margin-left: -"+t.width/2+"px;'></div>":"<div id='image' class='small' style='background-image: url("+t.url+"); width: "+t.width+"px; height: "+t.height+"px; margin-top: -"+parseInt(t.height/2)+"px; margin-left: -"+t.width/2+"px;'></div>"),a},build.no_content=function(t){var e;switch(e="\n\t\t\t<div class='no_content fadeIn'>\n\t\t\t\t"+build.iconic(t)+"\n\t\t\t",t){case"magnifying-glass":e+="<p>No results</p>";break;case"eye":e+="<p>No public albums</p>";break;case"cog":e+="<p>No configuration</p>";break;case"question-mark":e+="<p>Photo not found</p>"}return e+="</div>"},build.uploadModal=function(t,e){var i="",a=0,n=null;for(i="\n\t\t\t<h1>"+t+"</h1>\n\t\t\t<div class='rows'>\n\t\t\t";a<e.length;)n=e[a],n.name.length>40&&(n.name=n.name.substr(0,17)+"..."+n.name.substr(n.name.length-20,20)),i+="\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<a class='name'>"+lychee.escapeHTML(n.name)+"</a>\n\t\t\t\t",i+=n.supported===!0?"<a class='status'></a>":"<a class='status error'>Not supported</a>",i+="\n\t\t\t\t\t<p class='notice'></p>\n\t\t\t\t</div>\n\t\t\t\t",a++;return i+="</div>"},build.tags=function(t){var e="";return""!==t?(t=t.split(","),t.forEach(function(t,i,a){e+="<a class='tag'>"+t+"<span data-index='"+i+"'>"+build.iconic("x")+"</span></a>"})):e="<div class='empty'>No Tags</div>",e},build.usersModal=function(t,e){var i="",a=0;for(i="\n\t\t\t<h1>"+t+"</h1>\n\t\t\t<div class='rows'>\n\t\t\t";a<e.length;){user=e[a],user.name.length>40&&(user.name=user.name.substr(0,17)+"..."+user.name.substr(user.name.length-20,20));var n=user.role.charAt(0).toUpperCase()+user.role.slice(1),o="admin"==user.role;i+=o?"\n            <div class='row'>\n            ":"\n            <div class='row selectable' onclick='users.manageUser(\""+user.name+'", "'+user.id+"\")'>\n            ",i+="\n\t\t\t\t\t<a class='name'>"+lychee.escapeHTML(user.name)+"</a>\n          <a class='role'>"+n+"</a>\n          <a class='trash' onclick='users.deleteUser(\""+user.name+"\");event.cancelBubble=true;'>Delete</a>\n        </div>\n    ",a++}return i+="</div>"},build.userModal=function(t,e,i){for(var a="",n=0,a="\n\t\t\t<h1>"+t+"</h1>\n\t\t\t<div class='rows'>\n\t\t\t";n<i.length;){var o=i[n],l=o.id;o.title.length>40&&(o.title=o.title.substr(0,17)+"..."+o.title.substr(o.title.length-20,20)),a+="\n\t\t\t\t<div class='row'>\n    ";var s="1"==o.view?"checked":"",r="1"==o.upload?"checked":"",d="1"==o.erase?"checked":"";a+="\n\t\t\t\t\t<a class='name title'>"+lychee.escapeHTML(o.title)+"</a>\n\t\t\t\t  <form>\n\t\t\t\t\t  <div class='choice rowchoice'>\n\t\t\t\t\t\t  <label>\n\t\t\t\t\t\t\t  <input "+s+" type='checkbox' name='visible' onclick='users.changePrivileges("+e+", "+l+", 0, this.checked)'>\n\t\t\t\t\t\t\t  <span class='checkbox'>"+build.iconic("check")+"</span>\n\t\t\t\t\t\t\t  <span class='label'>View</span>\n\t\t\t\t\t\t  </label>\n            </div>\n\t\t\t\t\t  <div class='choice rowchoice'>\n\t\t\t\t\t\t  <label>\n\t\t\t\t\t\t\t  <input "+r+" type='checkbox' name='visible' onclick='users.changePrivileges("+e+", "+l+", 1, this.checked)'>\n\t\t\t\t\t\t\t  <span class='checkbox'>"+build.iconic("check")+"</span>\n\t\t\t\t\t\t\t  <span class='label'>Upload</span>\n\t\t\t\t\t\t  </label>\n            </div>\n\t\t\t\t\t  <div class='choice rowchoice'>\n\t\t\t\t\t\t  <label>\n\t\t\t\t\t\t\t  <input "+d+" type='checkbox' name='visible' onclick='users.changePrivileges("+e+", "+l+", 2, this.checked)'>\n\t\t\t\t\t\t\t  <span class='checkbox'>"+build.iconic("check")+"</span>\n\t\t\t\t\t\t\t  <span class='label'>Delete</span>\n\t\t\t\t\t\t  </label>\n            </div>\n          </form>\n\n          </div>\n    ",n++}return a+="</div>"},api={path:"php/api.php",onError:null},api.post=function(t,e,i){var a,n;loadingBar.show(),e=$.extend({"function":t},e),a=function(t){return setTimeout(function(){loadingBar.hide()},100),"string"==typeof t&&"Error: "===t.substring(0,7)?(api.onError(t.substring(7,t.length),e,t),!1):("1"===t?t=!0:""===t&&(t=!1),"string"==typeof t&&"{"===t.substring(0,1)&&"}"===t.substring(t.length-1,t.length)&&(t=$.parseJSON(t)),lychee.debugMode&&console.log(t),void i(t))},n=function(t,i,a){api.onError("Server error or API not found.",e,a)},$.ajax({type:"POST",url:api.path,data:e,dataType:"text",success:a,error:n})},header={_dom:$("header")},header.dom=function(t){return void 0===t||null===t||""===t?header._dom:header._dom.find(t)},header.bind=function(){var t="ontouchend"in document.documentElement?"touchend":"click";return header.dom("#title").on(t,function(t){return!!$(this).hasClass("editable")&&void(visible.photo()?contextMenu.photoTitle(album.getID(),photo.getID(),t):contextMenu.albumTitle(album.getID(),t))}),header.dom("#button_share").on(t,function(t){"1"===photo.json["public"]||"2"===photo.json["public"]?contextMenu.sharePhoto(photo.getID(),t):photo.setPublic(photo.getID(),t)}),header.dom("#button_share_album").on(t,function(t){"1"===album.json["public"]?contextMenu.shareAlbum(album.getID(),t):album.setPublic(album.getID(),!0,t)}),header.dom("#button_signin").on(t,lychee.loginDialog),header.dom("#button_settings").on(t,contextMenu.settings),header.dom("#button_info_album").on(t,sidebar.toggle),header.dom("#button_info").on(t,sidebar.toggle),header.dom(".button_add").on(t,contextMenu.add),header.dom("#button_more").on(t,function(t){contextMenu.photoMore(photo.getID(),t)}),header.dom("#button_move").on(t,function(t){contextMenu.move([photo.getID()],t)}),header.dom("#hostedwith").on(t,function(){window.open(lychee.website)}),header.dom("#button_trash_album").on(t,function(){album["delete"]([album.getID()])}),header.dom("#button_trash").on(t,function(){photo["delete"]([photo.getID()])}),header.dom("#button_archive").on(t,function(){album.getArchive(album.getID())}),header.dom("#button_star").on(t,function(){photo.setStar([photo.getID()])}),header.dom("#button_back_home").on(t,function(){lychee["goto"]("")}),header.dom("#button_back").on(t,function(){lychee["goto"](album.getID())}),header.dom("#search").on("keyup click",function(){search.find($(this).val())}),header.dom("#clearSearch").on(t,function(){header.dom("#search").focus(),search.reset()}),!0},header.show=function(){var t=-1*($("#imageview #image").height()/2)+20;return clearTimeout($(window).data("timeout")),lychee.imageview.removeClass("full"),header.dom().removeClass("hidden"),$("#imageview #image.small").length>0?$("#imageview #image").css("margin-top",t):$("#imageview #image").removeClass("full"),!0},header.hide=function(t){var e=arguments.length<=1||void 0===arguments[1]?500:arguments[1];if(visible.photo()&&!visible.sidebar()&&!visible.contextMenu()&&!visible.message()){var i=-1*($("#imageview #image").height()/2);return clearTimeout($(window).data("timeout")),$(window).data("timeout",setTimeout(function(){lychee.imageview.addClass("full"),header.dom().addClass("hidden"),$("#imageview #image.small").length>0?$("#imageview #image").css("margin-top",i):$("#imageview #image").addClass("full")},e)),!0}return!1},header.setTitle=function(){var t=arguments.length<=0||void 0===arguments[0]?"Untitled":arguments[0],e=header.dom("#title");return e.html(t+build.iconic("caret-bottom")),!0},header.setMode=function(t){var e=album.getID();switch(t){case"albums":header.dom().removeClass("view"),$("#tools_album, #tools_photo").hide(),$("#tools_albums").show();try{var i=localStorage.getItem("lychee_role");"user"===i&&$("#tools_albums .button_add").hide()}catch(a){}return!0;case"album":header.dom().removeClass("view"),$("#tools_albums, #tools_photo").hide(),$("#tools_album").show(),album.json.content===!1?$("#button_archive").hide():$("#button_archive").show(),lychee.publicMode===!0&&"0"===album.json.downloadable&&$("#button_archive").hide(),console.log(album.json),"s"===e||"f"===e||"r"===e?$("#button_info_album, #button_trash_album, #button_share_album").hide():"0"===e?($("#button_info_album, #button_share_album").hide(),$("#button_trash_album").show()):$("#button_info_album, #button_trash_album, #button_share_album").show(),"1"===album.json.upload?$("#tools_album .button_add").show():$("#tools_album .button_add").hide(),"1"===album.json.erase?$("#tools_album #button_trash_album").show():$("#tools_album #button_trash_album").hide();try{var i=localStorage.getItem("lychee_role");"admin"===i&&$("#tools_album .button_add, #button_trash_album").show()}catch(a){}return!0;case"photo":return header.dom().addClass("view"),$("#tools_albums, #tools_album").hide(),$("#tools_photo").show(),!0}return!1},header.setEditable=function(t){var e=header.dom("#title");return lychee.publicMode===!0&&(t=!1),t?e.addClass("editable"):e.removeClass("editable"),!0},visible={},visible.albums=function(){return"block"===$("#tools_albums").css("display")},visible.album=function(){return"block"===$("#tools_album").css("display")},visible.photo=function(){return $("#imageview.fadeIn").length>0},visible.search=function(){return null!==search.hash},visible.sidebar=function(){return sidebar.dom().hasClass("active")===!0},visible.sidebarbutton=function(){return!visible.albums()&&(!!visible.photo()||!!(visible.album()&&$("#button_info_album:visible").length>0))},visible.header=function(){return header.dom().hasClass("hidden")!==!0},visible.message=function(){return $(".message").length>0},visible.signin=function(){return $(".message .sign_in").length>0},visible.contextMenu=function(){return basicContext.visible()},visible.multiselect=function(){return $("#multiselect").length>0},sidebar={_dom:$("#sidebar"),types:{DEFAULT:0,TAGS:1},createStructure:{}},sidebar.dom=function(t){return void 0===t||null===t||""===t?sidebar._dom:sidebar._dom.find(t)},sidebar.bind=function(){var t="ontouchend"in document.documentElement?"touchend":"click";return sidebar.dom("#edit_title").off(t).on(t,function(){visible.photo()?photo.setTitle([photo.getID()]):visible.album()&&album.setTitle([album.getID()])}),sidebar.dom("#edit_description").off(t).on(t,function(){visible.photo()?photo.setDescription(photo.getID()):visible.album()&&album.setDescription(album.getID())}),sidebar.dom("#edit_tags").off(t).on(t,function(){photo.editTags([photo.getID()])}),sidebar.dom("#tags .tag span").off(t).on(t,function(){photo.deleteTag(photo.getID(),$(this).data("index"))}),!0},sidebar.toggle=function(){return!(!visible.sidebar()&&!visible.sidebarbutton())&&(header.dom(".button--info").toggleClass("active"),lychee.content.toggleClass("sidebar"),sidebar.dom().toggleClass("active"),!0)},sidebar.setSelectable=function(){var t=arguments.length<=0||void 0===arguments[0]||arguments[0];t===!0?sidebar.dom().removeClass("notSelectable"):sidebar.dom().addClass("notSelectable")},sidebar.changeAttr=function(t){var e=arguments.length<=1||void 0===arguments[1]?"-":arguments[1];return void 0!==t&&null!==t&&""!==t&&(""!==e&&null!==e||(e="-"),sidebar.dom(".attr_"+t).html(e),!0)},sidebar.createStructure.photo=function(t){if(void 0===t||null===t||""===t)return!1;var e=!1,i=t.takestamp+t.make+t.model+t.shutter+t.aperture+t.focal+t.iso,a={},n="";switch(lychee.publicMode===!1&&(e=!0),t["public"]){case"0":n="No";break;case"1":n="Yes";break;case"2":n="Yes (Album)";break;default:n="-"}return a.basics={title:"Basics",type:sidebar.types.DEFAULT,rows:[{title:"Title",value:t.title,editable:e},{title:"Uploaded",value:t.sysdate},{title:"Description",value:t.description,editable:e}]},a.image={title:"Image",type:sidebar.types.DEFAULT,rows:[{title:"Size",value:t.size},{title:"Format",value:t.type},{title:"Resolution",value:t.width+" x "+t.height}]},lychee.publicMode===!1?a.tags={title:"Tags",type:sidebar.types.TAGS,value:build.tags(t.tags),editable:e}:a.tags={},"0"!==i?a.exif={title:"Camera",type:sidebar.types.DEFAULT,rows:[{title:"Captured",value:t.takedate},{title:"Make",value:t.make},{title:"Type/Model",value:t.model},{title:"Shutter Speed",value:t.shutter},{title:"Aperture",value:t.aperture},{title:"Focal Length",value:t.focal},{title:"ISO",value:t.iso}]}:a.exif={},a.sharing={title:"Sharing",type:sidebar.types.DEFAULT,rows:[{title:"Public",value:n}]},a=[a.basics,a.image,a.tags,a.exif,a.sharing]},sidebar.createStructure.album=function(t){if(void 0===t||null===t||""===t)return!1;var e=!1,i={},a="",n="",o="",l="";switch(lychee.publicMode===!1&&"admin"===lychee.role&&(e=!0),t["public"]){case"0":a="No";break;case"1":a="Yes";break;default:a="-"}switch(t.visible){case"0":n="No";break;case"1":n="Yes";break;default:n="-"}switch(t.downloadable){case"0":o="No";break;case"1":o="Yes";break;default:o="-"}switch(t.password){case"0":l="No";break;case"1":l="Yes";break;default:l="-"}return i.basics={title:"Basics",type:sidebar.types.DEFAULT,rows:[{title:"Title",value:t.title,editable:e},{title:"Description",value:t.description,editable:e}]},i.album={title:"Album",type:sidebar.types.DEFAULT,rows:[{title:"Created",value:t.sysdate},{title:"Images",value:t.num}]},i.share={title:"Share",type:sidebar.types.DEFAULT,rows:[{title:"Public",value:a},{title:"Visible",value:n},{title:"Downloadable",value:o},{title:"Password",value:l}]},i=[i.basics,i.album,i.share]},sidebar.render=function(t){if(void 0===t||null===t||""===t)return!1;var e="",i=function(t){var e="";return e+="\n\t\t\t\t\t<div class='divider'>\n\t\t\t\t\t\t<h1>"+t.title+"</h1>\n\t\t\t\t\t</div>\n\t\t\t\t\t<table>\n\t\t\t\t\t",t.rows.forEach(function(t){var i=t.value;""!==i&&null!==i&&void 0!==i||(i="-"),i="<span class='attr_"+t.title.toLowerCase()+"'>"+i+"</span>",t.editable===!0&&(i+=" "+build.editIcon("edit_"+t.title.toLowerCase())),e+="\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>"+t.title+"</td>\n\t\t\t\t\t\t\t<td>"+i+"</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t"}),e+="\n\t\t\t\t\t</table>\n\t\t\t\t\t"},a=function(t){var e="";return e+="\n\t\t\t\t\t<div class='divider'>\n\t\t\t\t\t\t<h1>"+t.title+"</h1>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id='tags'>\n\t\t\t\t\t\t<div class='attr_"+t.title.toLowerCase()+"'>"+t.value+"</div>\n\t\t\t\t\t",t.editable===!0&&(e+=build.editIcon("edit_tags")),e+="\n\t\t\t\t\t</div>\n\t\t\t\t\t"};return t.forEach(function(t){t.type===sidebar.types.DEFAULT?e+=i(t):t.type===sidebar.types.TAGS&&(e+=a(t))}),e};var lychee={content:$("#content")},loadingBar={show:function(){},hide:function(){}};imageview=$("#imageview"),$(document).ready(function(){"ontouchend"in document.documentElement?eventName="touchend":eventName="click",api.onError=error,header.dom("#button_info").on(eventName,sidebar.toggle),header.dom("#button_direct").on(eventName,function(){var t=$("#imageview #image").css("background-image").replace(/"/g,"").replace(/url\(|\)$/gi,"");window.open(t,"_newtab")}),loadPhotoInfo(gup("p"))}),getPhotoSize=function(t){var e="big",i=!1,a=""!==t.medium,n=window.devicePixelRatio,o={width:$(window).width()-60,height:$(window).height()-100};return(t.width>o.width||t.width>o.height)&&(i=!0),void 0!==n&&n>1&&(o.width=o.width*n,o.height=o.height*n),a===!0&&1920>o.width&&1080>o.height&&(e="medium"),i===!1&&t.width<o.width&&t.width<o.height&&(e="small"),e},loadPhotoInfo=function(t){var e={photoID:t,albumID:0,password:""};api.post("Photo::get",e,function(t){if("Warning: Photo private!"===t||"Warning: Wrong password!"===t)return $("body").append(build.no_content("question-mark")),$("body").removeClass("view"),header.dom().remove(),!1;t.title||(t.title="Untitled"),document.title="Lychee - "+t.title,header.dom("#title").html(t.title);var e=getPhotoSize(t);imageview.html(build.imageview(t,e,!0)),imageview.find(".arrow_wrapper").remove(),imageview.addClass("fadeIn").show();var i=sidebar.createStructure.photo(t),a=sidebar.render(i);sidebar.dom(".wrapper").html(a),sidebar.bind()})},error=function(t,e,i){console.error({description:t,params:e,response:i}),loadingBar.show("error",t)};