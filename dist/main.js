function gup(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e="[\\?&]"+t+"=([^&#]*)",o=new RegExp(e),n=o.exec(window.location.href);return null===n?"":n[1]}this.basicModal={_lastFocus:null,_dom:function(t){return null==t?$(".basicModal"):$(".basicModal").find(""+t)},_valid:function(t){var e,o,n;return null!=t&&(null==t.body&&(t.body=""),null==t["class"]&&(t["class"]=""),null==t.closable&&(t.closable=!0),null!=(null!=(e=t.buttons)?e.action:void 0)&&(null==t.buttons.action["class"]&&(t.buttons.action["class"]=""),null==t.buttons.action.title&&(t.buttons.action.title="OK")),null!=(null!=(o=t.buttons)?o.cancel:void 0)?null==t.buttons.cancel.title&&(t.buttons.cancel.title="Cancel"):null!=(null!=(n=t.buttons)?n.action:void 0)&&(t.buttons.action["class"]+=" basicModal__button--full"),!0)},_build:function(t){var e,o,n,i;return o='<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><path d="M405 136.798l-29.798-29.798-119.202 119.202-119.202-119.202-29.798 29.798 119.202 119.202-119.202 119.202 29.798 29.798 119.202-119.202 119.202 119.202 29.798-29.798-119.202-119.202z"/></svg>',e="<div class='basicModalContainer basicModalContainer--fadeIn' data-closable='"+t.closable+"'>\n\t<div class='basicModal basicModal--fadeIn "+t["class"]+'\' role="dialog">\n\t\t'+t.body,null!=(null!=(n=t.buttons)?n.cancel:void 0)&&(e+=-1===t["class"].indexOf("login")?"<a id='basicModal__cancel' class='basicModal__button'>"+t.buttons.cancel.title+"</a>":"<div id='basicModal__cancel' class='basicModal__button' aria-label='close'>"+o+"</div>"),null!=(null!=(i=t.buttons)?i.action:void 0)&&(e+="<a id='basicModal__action' class='basicModal__button "+t.buttons.action["class"]+"'>"+t.buttons.action.title+"</a>"),e+="\t</div>\n</div>"},_getValues:function(){var t;return t=null,(0!==basicModal._dom("input").length||0!==basicModal._dom(".basicModal__dropdown").length)&&(t={},basicModal._dom("input").each(function(){var e,o;return e=$(this).attr("data-name"),o=$(this).val(),t[e]=o}),basicModal._dom(".basicModal__dropdown").each(function(){var e,o;return e=$(this).attr("data-name"),o=$(this).attr("data-value"),t[e]=o})),t},_bind:function(t){var e,o,n,i,a;return null!=(null!=(o=t.buttons)&&null!=(n=o.cancel)?n.fn:void 0)&&basicModal._dom("#basicModal__cancel").click(function(){return!$(this).hasClass("basicModal__button--active")&&($(this).addClass("basicModal__button--active"),t.buttons.cancel.fn())}),null!=(null!=(i=t.buttons)&&null!=(a=i.action)?a.fn:void 0)&&basicModal._dom("#basicModal__action").click(function(){return!$(this).hasClass("basicModal__button--active")&&($(this).addClass("basicModal__button--active"),t.buttons.action.fn(basicModal._getValues()))}),basicModal._dom("input").keydown(function(){return $(this).removeClass("error")}),e=null,basicModal._dom(".basicModal__dropdown .front").click(function(){var t;return t=$(this).parent(),clearTimeout(e),t.find(".back").show(),t.addClass("flip")}),basicModal._dom('.basicModal__dropdown .back ul li[class!="separator"]').click(function(){var t,o;return t=$(this).parent().parent().parent(),o=$(this).clone(),o.find("span").remove(),o=o.html().trim(),t.find(".front span").html(o),t.attr("data-value",$(this).data("value")),t.removeClass("flip"),e=setTimeout(function(){return t.find(".back").hide()},3e3)})},show:function(t){return!!basicModal._valid(t)&&(basicModal._lastFocus=document.activeElement,0!==basicModal._dom().parent().length?(basicModal.close(!0),setTimeout(function(){return basicModal.show(t)},301),!1):($("body").append(basicModal._build(t)),basicModal._bind(t),0!==basicModal._dom("input").length&&basicModal._dom("input")[0].select(),null!=t.callback&&t.callback(),!0))},error:function(t){return basicModal.reset(),basicModal._dom("input[data-name='"+t+"'], .basicModal__dropdown[data-name='"+t+"']").addClass("error").focus().select(),basicModal._dom().removeClass("basicModal--fadeIn basicModal--shake"),setTimeout(function(){return basicModal._dom().addClass("basicModal--shake")},1)},visible:function(){return 0!==basicModal._dom().parent().length},action:function(){return 0!==basicModal._dom("#basicModal__action").length&&(basicModal._dom("#basicModal__action").click(),!0)},cancel:function(){return 0!==basicModal._dom("#basicModal__cancel").length&&(basicModal._dom("#basicModal__cancel").click(),!0)},reset:function(){return basicModal._dom(".basicModal__button").removeClass("basicModal__button--active"),basicModal._dom(".input, .basicModal__dropdown").removeClass("error"),!0},close:function(t){var e;return e=basicModal._dom().parent(),(null==t||t===!0)&&(("true"===e.attr("data-closable")||t===!0)&&(e.removeClass("basicModalContainer--fadeIn").addClass("basicModalContainer--fadeOut"),setTimeout(function(){return e.remove()},300),null!=basicModal._lastFocus&&(basicModal._lastFocus.focus(),basicModal._lastFocus=null),!0))}},album={json:null},album.getID=function(){var t=null,e=function(t){return"0"===t||"f"===t||"s"===t||"r"===t||$.isNumeric(t)};return photo.json?t=photo.json.album:album.json&&(t=album.json.id),e(t)===!1&&(t=$(".album:hover, .album.active").attr("data-id")),e(t)===!1&&(t=$(".photo:hover, .photo.active").attr("data-album-id")),e(t)===!0&&t},album.load=function(t,e){var o,n,i,a;password.get(t,function(){e||lychee.animate("#content","contentZoomOut"),o=(new Date).getTime(),n={albumID:t,password:password.value},api.post("Album::get",n,function(n){return"Warning: Album private!"===n?(void 0!=document.location.hash.replace("#","").split("/")[1]?lychee.setMode("view"):(lychee.content.show(),lychee["goto"]("")),!1):"Warning: Wrong password!"===n?(album.load(t,e),!1):(album.json=n,i=(new Date).getTime()-o,a=i>300?0:300-i,e===!0&&(a=0),visible.albums()||visible.photo()||visible.album()||(a=0),void setTimeout(function(){view.album.init(),e||(lychee.animate("#content","contentZoomIn"),header.setMode("album"))},a))})})},album.parse=function(){album.json.title||(album.json.title="Untitled")},album.add=function(){var t;t=function(t){var e,o=t.title;basicModal.close(),e=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},0===o.length&&(o="Untitled"),api.post("Album::add",{title:o},function(t){t===!0&&(t=1),t!==!1&&e(t)?(albums.refresh(),lychee["goto"](t)):lychee.error(null,params,t)})},basicModal.show({body:"<p>Enter a title for the new album: <input class='text' data-name='title' type='text' maxlength='50' placeholder='Title' value='Untitled'></p>",buttons:{action:{title:"Create Album",fn:t},cancel:{title:"Cancel",fn:basicModal.close}}})},album["delete"]=function(t){var e={},o={},n="",i="";return!!t&&(t instanceof Array==!1&&(t=[t]),e.fn=function(){var e;basicModal.close(),e={albumIDs:t.join()},api.post("Album::delete",e,function(o){visible.albums()?t.forEach(function(t){albums.json.num--,view.albums.content["delete"](t),albums.deleteByID(t)}):(albums.refresh(),lychee["goto"]("")),o!==!0&&lychee.error(null,e,o)})},"0"===t.toString()?(e.title="Clear Unsorted",o.title="Keep Unsorted",n="<p>Are you sure you want to delete all photos from 'Unsorted'?<br>This action can't be undone!</p>"):1===t.length?(e.title="Delete Album and Photos",o.title="Keep Album",album.json?i=album.json.title:albums.json&&(i=albums.getByID(t).title),n="<p>Are you sure you want to delete the album '"+i+"' and all of the photos it contains? This action can't be undone!</p>"):(e.title="Delete Albums and Photos",o.title="Keep Albums",n="<p>Are you sure you want to delete all "+t.length+" selected albums and all of the photos they contain? This action can't be undone!</p>"),void basicModal.show({body:n,buttons:{action:{title:e.title,fn:e.fn,"class":"red"},cancel:{title:o.title,fn:basicModal.close}}}))},album.setTitle=function(t){var e,o="",n="",i="";return!!t&&(t instanceof Array==!1&&(t=[t]),1===t.length&&(album.json?o=album.json.title:albums.json&&(o=albums.getByID(t).title),o||(o=""),o=o.replace(/'/g,"&apos;")),e=function(e){var o,n=e.title;if(basicModal.close(),n=lychee.removeHTML(n),n=""===n?"Untitled":n,visible.album()){if(album.json.title=n,view.album.title(),albums.json){var i=t[0];albums.getByID(i).title=n}}else visible.albums()&&t.forEach(function(t){albums.getByID(t).title=n,view.albums.content.title(t)});o={albumIDs:t.join(),title:n},api.post("Album::setTitle",o,function(t){t!==!0&&lychee.error(null,o,t)})},n="<input class='text' data-name='title' type='text' maxlength='50' placeholder='Title' value='"+o+"'>",i=1===t.length?"<p>Enter a new title for this album: "+n+"</p>":"<p>Enter a title for all "+t.length+" selected albums: "+n+"</p>",void basicModal.show({body:i,buttons:{action:{title:"Set Title",fn:e},cancel:{title:"Cancel",fn:basicModal.close}}}))},album.setDescription=function(t){var e,o=album.json.description.replace(/'/g,"&apos;");e=function(e){var o,n=e.description;basicModal.close(),n=lychee.removeHTML(n),visible.album()&&(album.json.description=n,view.album.description()),o={albumID:t,description:n},api.post("Album::setDescription",o,function(t){t!==!0&&lychee.error(null,o,t)})},basicModal.show({body:"<p>Please enter a description for this album: <input class='text' data-name='description' type='text' maxlength='800' placeholder='Description' value='"+o+"'></p>",buttons:{action:{title:"Set Description",fn:e},cancel:{title:"Cancel",fn:basicModal.close}}})},album.setPublic=function(t,e,o){var n,i="";if(albums.refresh(),e===!0){var a="",l="",s={};return s.fn=function(){album.setPublic(album.getID(),!1,o)},"1"===album.json["public"]?(s.title="Edit Sharing",l="The sharing-properties of this album will be changed to the following:"):(s.title="Share Album",l="This album will be shared with the following properties:"),a="\n\t\t\t\t<p class='less'>"+l+"</p>\n\t\t\t\t<form>\n\t\t\t\t\t<div class='choice'>\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input type='checkbox' name='visible'>\n\t\t\t\t\t\t\t<span class='checkbox'>"+build.iconic("check")+"</span>\n\t\t\t\t\t\t\t<span class='label'>Visible</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<p>Listed to visitors of your Lychee.</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='choice'>\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input type='checkbox' name='downloadable'>\n\t\t\t\t\t\t\t<span class='checkbox'>"+build.iconic("check")+"</span>\n\t\t\t\t\t\t\t<span class='label'>Downloadable</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<p>Visitors of your Lychee can download this album.</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='choice'>\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<input type='checkbox' name='password'>\n\t\t\t\t\t\t\t<span class='checkbox'>"+build.iconic("check")+"</span>\n\t\t\t\t\t\t\t<span class='label'>Password protected</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<p>Only accessible with a valid password.</p>\n\t\t\t\t\t\t<input class='text' data-name='password' type='password' placeholder='password' value=''>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t\t",basicModal.show({body:a,buttons:{action:{title:s.title,fn:s.fn},cancel:{title:"Cancel",fn:basicModal.close}}}),("1"===album.json["public"]&&"1"===album.json.visible||"0"===album.json["public"])&&$('.basicModal .choice input[name="visible"]').click(),"1"===album.json.downloadable&&$('.basicModal .choice input[name="downloadable"]').click(),$('.basicModal .choice input[name="password"]').on("change",function(){$(this).prop("checked")===!0?$('.basicModal .choice input[data-name="password"]').show().focus():$('.basicModal .choice input[data-name="password"]').hide()}),!0}basicModal.visible()?(album.json["public"]="1",1===$('.basicModal .choice input[name="visible"]:checked').length?album.json.visible="1":album.json.visible="0",1===$('.basicModal .choice input[name="downloadable"]:checked').length?album.json.downloadable="1":album.json.downloadable="0",1===$('.basicModal .choice input[name="password"]:checked').length?(i=$('.basicModal .choice input[data-name="password"]').val(),album.json.password="1"):(i="",album.json.password="0"),basicModal.close()):album.json["public"]="0",visible.album()&&(album.json.visible="0"===album.json["public"]?"0":album.json.visible,album.json.downloadable="0"===album.json["public"]?"0":album.json.downloadable,album.json.password="0"===album.json["public"]?"0":album.json.password,view.album["public"](),view.album.visible(),view.album.downloadable(),view.album.password(),"1"===album.json["public"]&&contextMenu.shareAlbum(t,o)),n={albumID:t,"public":album.json["public"],password:i,visible:album.json.visible,downloadable:album.json.downloadable},api.post("Album::setPublic",n,function(t){t!==!0&&lychee.error(null,n,t)})},album.share=function(t){var e="",o=location.href;switch(t){case 0:e="https://twitter.com/share?url="+encodeURI(o);break;case 1:e="http://www.facebook.com/sharer.php?u="+encodeURI(o)+"&t="+encodeURI(album.json.title);break;case 2:e="mailto:?subject="+encodeURI(album.json.title)+"&body="+encodeURI(o);break;default:e=""}e.length>5&&(location.href=e)},album.getArchive=function(t){var e,o=api.path+"?function=Album::getArchive&albumID="+t;e=location.href.indexOf("index.html")>0?location.href.replace(location.hash,"").replace("index.html",o):location.href.replace(location.hash,"")+o,lychee.publicMode===!0&&(e+="&password="+password.value),location.href=e},album.merge=function(t){var e,o="",n="",i="";return!!t&&(t instanceof Array==!1&&(t=[t]),albums.json&&(o=albums.getByID(t[0]).title),o||(o=""),o=o.replace(/'/g,"&apos;"),2===t.length?(albums.json&&(n=albums.getByID(t[1]).title),n||(n=""),n=n.replace(/'/g,"&apos;"),i="<p>Are you sure you want to merge the album '"+n+"' into the album '"+o+"'?</p>"):i="<p>Are you sure you want to merge all selected albums into the album '"+o+"'?</p>",e=function(){var e;basicModal.close(),e={albumIDs:t.join()},api.post("Album::merge",e,function(t){t!==!0?lychee.error(null,e,t):(albums.refresh(),albums.load())})},void basicModal.show({body:i,buttons:{action:{title:"Merge Albums",fn:e,"class":"red"},cancel:{title:"Don't Merge",fn:basicModal.close}}}))},albums={json:null},albums.load=function(){var t,e,o;lychee.animate("#content","contentZoomOut"),t=(new Date).getTime(),null===albums.json?api.post("Album::getAll",{},function(n){lychee.publicMode===!1&&albums._createSmartAlbums(n.smartalbums),albums.json=n,e=(new Date).getTime()-t,o=e>300?0:300-e,visible.albums()||visible.photo()||visible.album()||(o=0),visible.album()&&""===lychee.content.html()&&(o=0),setTimeout(function(){header.setMode("albums"),view.albums.init(),lychee.animate("#content","contentZoomIn")},o)}):setTimeout(function(){header.setMode("albums"),view.albums.init(),lychee.animate("#content","contentZoomIn")},300)},albums.parse=function(t){"1"===t.password&&lychee.publicMode===!0?(t.thumbs[0]="src/images/password.svg",t.thumbs[1]="src/images/password.svg",t.thumbs[2]="src/images/password.svg"):(t.thumbs[0]||(t.thumbs[0]="src/images/no_images.svg"),t.thumbs[1]||(t.thumbs[1]="src/images/no_images.svg"),t.thumbs[2]||(t.thumbs[2]="src/images/no_images.svg"))},albums._createSmartAlbums=function(t){t.unsorted={id:0,title:"Unsorted",sysdate:t.unsorted.num+" photos",unsorted:"1",thumbs:t.unsorted.thumbs},t.starred={id:"f",title:"Starred",sysdate:t.starred.num+" photos",star:"1",thumbs:t.starred.thumbs},t["public"]={id:"s",title:"Public",sysdate:t["public"].num+" photos","public":"1",thumbs:t["public"].thumbs},t.recent={id:"r",title:"Recent",sysdate:t.recent.num+" photos",recent:"1",thumbs:t.recent.thumbs}},albums.getByID=function(t){if(void 0!==t&&null!==t&&albums.json&&albums.json.albums){var e=void 0;return $.each(albums.json.albums,function(o){var n=albums.json.albums[o];n.id==t&&(e=n)}),e}},albums.deleteByID=function(t){if(void 0===t||null===t)return!1;if(!albums.json)return!1;if(!albums.json.albums)return!1;var e=!1;return $.each(albums.json.albums,function(o){if(albums.json.albums[o].id==t)return albums.json.albums.splice(o,1),e=!0,!1}),e},albums.refresh=function(){albums.json=null},api={path:"php/api.php",onError:null},api.post=function(t,e,o){var n,i;loadingBar.show(),e=$.extend({"function":t},e),n=function(t){return setTimeout(function(){loadingBar.hide()},100),"string"==typeof t&&"Error: "===t.substring(0,7)?(api.onError(t.substring(7,t.length),e,t),!1):("1"===t?t=!0:""===t&&(t=!1),"string"==typeof t&&"{"===t.substring(0,1)&&"}"===t.substring(t.length-1,t.length)&&(t=$.parseJSON(t)),lychee.debugMode&&console.log(t),void o(t))},i=function(t,o,n){api.onError("Server error or API not found.",e,n)},$.ajax({type:"POST",url:api.path,data:e,dataType:"text",success:n,error:i})},window.build={},build.iconic=function(t,e){var o="";return e=e||"",o="\n\t\t\t<svg class='iconic "+e+"'>\n\t\t\t\t<use xlink:href='#"+t+"' />\n\t\t\t</svg>\n\t\t\t"},build.divider=function(t){var e="";return e="\n\t\t\t<div class='divider'>\n\t\t\t\t<h1>"+t+"</h1>\n\t\t\t</div>\n\t\t\t"},build.editIcon=function(t){var e="";return e="<div id='"+t+"' class='edit'>"+build.iconic("pencil")+"</div>"},build.multiselect=function(t,e){var o="";return o="<div id='multiselect' style='top: "+t+"px; left: "+e+"px;'></div>"},build.album=function(t){if(null===t||void 0===t)return"";var e="",o=lychee.retinize(t.thumbs[0]),n=o.path,i=o.hasRetina;return e="\n\t\t\t<div class='album' data-id='"+t.id+"'>\n\t\t\t\t<img src='"+t.thumbs[2]+"' width='200' height='200' alt='thumb' data-retina='false'>\n\t\t\t\t<img src='"+t.thumbs[1]+"' width='200' height='200' alt='thumb' data-retina='false'>\n\t\t\t\t<img src='"+n+"' width='200' height='200' alt='thumb' data-retina='"+i+"'>\n\t\t\t\t<div class='overlay'>\n\t\t\t\t\t<h1 title='"+t.title+"'>"+t.title+"</h1>\n\t\t\t\t\t<a>"+t.sysdate+"</a>\n\t\t\t\t</div>\n\t\t\t",lychee.publicMode===!1&&("1"===t.star&&(e+="<a class='badge icn-star'>"+build.iconic("star")+"</a>"),"1"===t["public"]&&(e+="<a class='badge icn-share'>"+build.iconic("eye")+"</a>"),"1"===t.unsorted&&(e+="<a class='badge'>"+build.iconic("list")+"</a>"),"1"===t.recent&&(e+="<a class='badge'>"+build.iconic("clock")+"</a>"),"1"===t.password&&(e+="<a class='badge'>"+build.iconic("lock-locked")+"</a>")),e+="</div>"},build.photo=function(t){if(null===t||void 0===t)return"";var e="",o=lychee.retinize(t.thumbUrl),n=o.path;o.hasRetina;return console.log(t),e="\n\t\t\t<div class='photo' data-album-id='"+t.album+"' data-id='"+t.id+"'>\n\t\t\t\t<img src='"+n+"' width='200' height='200' alt='thumb'>\n\t\t\t\t<div class='overlay'>\n\t\t\t\t\t<h1 title='"+t.title+"'>"+t.title+"</h1>\n\t\t\t",e+="1"===t.cameraDate?"<a><span title='Camera Date'>"+build.iconic("camera-slr")+"</span>"+t.sysdate+"</a>":"<a>"+t.sysdate+"</a>",e+="</div>",lychee.publicMode===!1&&("1"===t.star&&(e+="<a class='badge iconic-star'>"+build.iconic("star")+"</a>"),"1"===t["public"]&&"1"!==album.json["public"]&&(e+="<a class='badge iconic-share'>"+build.iconic("eye")+"</a>")),e+="</div>"},build.imageview=function(t,e,o){if(null===t||void 0===t)return"";var n="";return n="\n\t\t\t<div class='arrow_wrapper arrow_wrapper--previous'><a id='previous'>"+build.iconic("caret-left")+"</a></div>\n\t\t\t<div class='arrow_wrapper arrow_wrapper--next'><a id='next'>"+build.iconic("caret-right")+"</a></div>\n\t\t\t","big"===e?n+=o===!0?"<div id='image' style='background-image: url("+t.url+")'></div>":"<div id='image' style='background-image: url("+t.url+");' class='full'></div>":"medium"===e?n+=o===!0?"<div id='image' style='background-image: url("+t.medium+")'></div>":"<div id='image' style='background-image: url("+t.medium+");' class='full'></div>":"small"===e&&(n+=o===!0?"<div id='image' class='small' style='background-image: url("+t.url+"); width: "+t.width+"px; height: "+t.height+"px; margin-top: -"+parseInt(t.height/2-20)+"px; margin-left: -"+t.width/2+"px;'></div>":"<div id='image' class='small' style='background-image: url("+t.url+"); width: "+t.width+"px; height: "+t.height+"px; margin-top: -"+parseInt(t.height/2)+"px; margin-left: -"+t.width/2+"px;'></div>"),n},build.no_content=function(t){var e;switch(e="\n\t\t\t<div class='no_content fadeIn'>\n\t\t\t\t"+build.iconic(t)+"\n\t\t\t",t){case"magnifying-glass":e+="<p>No results</p>";break;case"eye":e+="<p>No public albums</p>";break;case"cog":e+="<p>No configuration</p>";break;case"question-mark":e+="<p>Photo not found</p>"}return e+="</div>"},build.uploadModal=function(t,e){var o="",n=0,i=null;for(o="\n\t\t\t<h1>"+t+"</h1>\n\t\t\t<div class='rows'>\n\t\t\t";n<e.length;)i=e[n],i.name.length>40&&(i.name=i.name.substr(0,17)+"..."+i.name.substr(i.name.length-20,20)),o+="\n\t\t\t\t<div class='row'>\n\t\t\t\t\t<a class='name'>"+lychee.escapeHTML(i.name)+"</a>\n\t\t\t\t",o+=i.supported===!0?"<a class='status'></a>":"<a class='status error'>Not supported</a>",o+="\n\t\t\t\t\t<p class='notice'></p>\n\t\t\t\t</div>\n\t\t\t\t",n++;return o+="</div>"},build.tags=function(t){var e="";return""!==t?(t=t.split(","),t.forEach(function(t,o,n){e+="<a class='tag'>"+t+"<span data-index='"+o+"'>"+build.iconic("x")+"</span></a>"})):e="<div class='empty'>No Tags</div>",e},build.usersModal=function(t,e){var o="",n=0;for(o="\n\t\t\t<h1>"+t+"</h1>\n\t\t\t<div class='rows'>\n\t\t\t";n<e.length;){user=e[n],user.name.length>40&&(user.name=user.name.substr(0,17)+"..."+user.name.substr(user.name.length-20,20));var i=user.role.charAt(0).toUpperCase()+user.role.slice(1),a="admin"==user.role;o+=a?"\n            <div class='row'>\n            ":"\n            <div class='row selectable' onclick='users.manageUser(\""+user.name+'", "'+user.id+"\")'>\n            ",o+="\n\t\t\t\t\t<a class='name'>"+lychee.escapeHTML(user.name)+"</a>\n          <a class='role'>"+i+"</a>\n          <a class='trash' onclick='users.deleteUser(\""+user.name+"\");event.cancelBubble=true;'>Delete</a>\n        </div>\n    ",n++}return o+="</div>"},build.userModal=function(t,e,o){for(var n="",i=0,n="\n\t\t\t<h1>"+t+"</h1>\n\t\t\t<div class='rows'>\n\t\t\t";i<o.length;){var a=o[i],l=a.id;a.title.length>40&&(a.title=a.title.substr(0,17)+"..."+a.title.substr(a.title.length-20,20)),n+="\n\t\t\t\t<div class='row'>\n    ";var s="1"==a.view?"checked":"",c="1"==a.upload?"checked":"",r="1"==a.erase?"checked":"";n+="\n\t\t\t\t\t<a class='name title'>"+lychee.escapeHTML(a.title)+"</a>\n\t\t\t\t  <form>\n\t\t\t\t\t  <div class='choice rowchoice'>\n\t\t\t\t\t\t  <label>\n\t\t\t\t\t\t\t  <input "+s+" type='checkbox' name='visible' onclick='users.changePrivileges("+e+", "+l+", 0, this.checked)'>\n\t\t\t\t\t\t\t  <span class='checkbox'>"+build.iconic("check")+"</span>\n\t\t\t\t\t\t\t  <span class='label'>View</span>\n\t\t\t\t\t\t  </label>\n            </div>\n\t\t\t\t\t  <div class='choice rowchoice'>\n\t\t\t\t\t\t  <label>\n\t\t\t\t\t\t\t  <input "+c+" type='checkbox' name='visible' onclick='users.changePrivileges("+e+", "+l+", 1, this.checked)'>\n\t\t\t\t\t\t\t  <span class='checkbox'>"+build.iconic("check")+"</span>\n\t\t\t\t\t\t\t  <span class='label'>Upload</span>\n\t\t\t\t\t\t  </label>\n            </div>\n\t\t\t\t\t  <div class='choice rowchoice'>\n\t\t\t\t\t\t  <label>\n\t\t\t\t\t\t\t  <input "+r+" type='checkbox' name='visible' onclick='users.changePrivileges("+e+", "+l+", 2, this.checked)'>\n\t\t\t\t\t\t\t  <span class='checkbox'>"+build.iconic("check")+"</span>\n\t\t\t\t\t\t\t  <span class='label'>Delete</span>\n\t\t\t\t\t\t  </label>\n            </div>\n          </form>\n\n          </div>\n    ",i++}return n+="</div>"},contextMenu={},contextMenu.add=function(t){var e;"admin"===lychee.role?e=[{type:"item",title:build.iconic("image")+"Upload Photo",fn:function(){$("#upload_files").click()}},{type:"separator"},{type:"item",title:build.iconic("link-intact")+"Import from Link",fn:upload.start.url},{type:"item",title:build.iconic("dropbox","ionicons")+"Import from Dropbox",fn:upload.start.dropbox},{type:"item",title:build.iconic("terminal")+"Import from Server",fn:upload.start.server},{type:"separator"},{type:"item",title:build.iconic("folder")+"New Album",fn:album.add}]:"user"===lychee.role&&(e=[{type:"item",title:build.iconic("image")+"Upload Photo",fn:function(){$("#upload_files").click()}},{type:"separator"},{type:"item",title:build.iconic("link-intact")+"Import from Link",fn:upload.start.url}]),basicContext.show(e,t),upload.notify()},contextMenu.settings=function(t){var e;"admin"===lychee.role?e=[{type:"item",title:build.iconic("person")+"Change Password",fn:users.changePassword},{type:"item",title:build.iconic("person")+"Manage Users",fn:users.manageUsers},{type:"item",title:build.iconic("sort-ascending")+"Change Sorting",fn:settings.setSorting},{type:"item",title:build.iconic("dropbox","ionicons")+"Set Dropbox",fn:settings.setDropboxKey},{type:"separator"},{type:"item",title:build.iconic("info")+"About Lychee",fn:function(){window.open(lychee.website)}},{type:"item",title:build.iconic("wrench")+"Diagnostics",fn:function(){window.open("plugins/check/")}},{type:"item",title:build.iconic("align-left")+"Show Log",fn:function(){window.open("plugins/displaylog/")}},{type:"separator"},{type:"item",title:build.iconic("account-logout")+"Sign Out",fn:lychee.logout}]:"user"===lychee.role&&(e=[{type:"item",title:build.iconic("person")+"Change Password",fn:users.changePassword},{type:"item",title:build.iconic("sort-ascending")+"Change Sorting",fn:settings.setSorting},{type:"separator"},{type:"item",title:build.iconic("info")+"About Lychee",fn:function(){window.open(lychee.website)}},{type:"separator"},{type:"item",title:build.iconic("account-logout")+"Sign Out",fn:lychee.logout}]),console.log("hej"+lychee.role),basicContext.show(e,t)},contextMenu.album=function(t,e){if("admin"!==lychee.role)return!1;if("0"===t||"f"===t||"s"===t||"r"===t)return!1;var o=[{type:"item",title:build.iconic("pencil")+"Rename",fn:function(){album.setTitle([t])}},{type:"item",title:build.iconic("collapse-left")+"Merge",fn:function(){basicContext.close(),contextMenu.mergeAlbum(t,e)}},{type:"item",title:build.iconic("trash")+"Delete",fn:function(){album["delete"]([t])}}];albums.json&&albums.json.albums&&Object.keys(albums.json.albums).length<=1&&o.splice(1,1),$('.album[data-id="'+t+'"]').addClass("active"),basicContext.show(o,e,contextMenu.close)},contextMenu.albumMulti=function(t,e){if("admin"!==lychee.role)return!1;multiselect.stopResize();var o=[{type:"item",title:build.iconic("pencil")+"Rename All",fn:function(){album.setTitle(t)}},{type:"item",title:build.iconic("collapse-left")+"Merge All",fn:function(){album.merge(t)}},{type:"item",title:build.iconic("trash")+"Delete All",fn:function(){album["delete"](t)}}];basicContext.show(o,e,contextMenu.close)},contextMenu.albumTitle=function(t,e){var o=[];api.post("Album::getAll",{},function(n){n.albums&&n.num>1&&($.each(n.albums,function(e){var n=this,i="";n.thumbs[0]||(n.thumbs[0]="src/images/no_cover.svg"),i="<img class='cover' width='16' height='16' src='"+n.thumbs[0]+"'><div class='title'>"+n.title+"</div>",n.id!=t&&o.push({type:"item",title:i,fn:function(){lychee["goto"](n.id)}})}),"admin"===lychee.role&&o.unshift({type:"separator"})),"admin"===lychee.role&&o.unshift({type:"item",title:build.iconic("pencil")+"Rename",fn:function(){album.setTitle([t])}}),basicContext.show(o,e,contextMenu.close)})},contextMenu.mergeAlbum=function(t,e){if("admin"!==lychee.role)return!1;var o=[];api.post("Album::getAll",{},function(n){return n.albums&&n.num>1&&$.each(n.albums,function(){var e=this;e.thumbs[0]||(e.thumbs[0]="src/images/no_cover.svg"),e.contextTitle="<img class='cover' width='16' height='16' src='"+e.thumbs[0]+"'><div class='title'>"+e.title+"</div>",e.id!=t&&o.push({type:"item",title:e.contextTitle,fn:function(){album.merge([t,e.id])}})}),0!==o.length&&void basicContext.show(o,e,contextMenu.close)})},contextMenu.photo=function(t,e){var o;"admin"==lychee.role?o=[{type:"item",title:build.iconic("star")+"Star",fn:function(){photo.setStar([t])}},{type:"item",title:build.iconic("tag")+"Tags",fn:function(){photo.editTags([t])}},{type:"separator"},{type:"item",title:build.iconic("pencil")+"Rename",fn:function(){photo.setTitle([t])}},{type:"item",title:build.iconic("layers")+"Duplicate",fn:function(){photo.duplicate([t])}},{type:"item",title:build.iconic("folder")+"Move",fn:function(){basicContext.close(),contextMenu.move([t],e)}},{type:"item",title:build.iconic("trash")+"Delete",fn:function(){photo["delete"]([t])}}]:"user"==lychee.role&&(o=[{type:"item",title:build.iconic("star")+"Star",fn:function(){photo.setStar([t])}},{type:"item",title:build.iconic("tag")+"Tags",fn:function(){photo.editTags([t])}},{type:"separator"},{type:"item",title:build.iconic("pencil")+"Rename",fn:function(){photo.setTitle([t])}},{type:"item",title:build.iconic("layers")+"Duplicate",fn:function(){photo.duplicate([t])}}],1==album.json.erase&&o.push({type:"item",title:build.iconic("trash")+"Delete",fn:function(){photo["delete"]([t])}})),$('.photo[data-id="'+t+'"]').addClass("active"),basicContext.show(o,e,contextMenu.close)},contextMenu.photoMulti=function(t,e){multiselect.stopResize();var o=[{type:"item",title:build.iconic("star")+"Star All",fn:function(){photo.setStar(t)}},{type:"item",title:build.iconic("tag")+"Tag All",fn:function(){photo.editTags(t)}},{type:"separator"},{type:"item",title:build.iconic("pencil")+"Rename All",fn:function(){photo.setTitle(t)}},{type:"item",title:build.iconic("layers")+"Duplicate All",fn:function(){photo.duplicate(t)}},{type:"item",title:build.iconic("folder")+"Move All",fn:function(){basicContext.close(),contextMenu.move(t,e)}},{type:"item",title:build.iconic("trash")+"Delete All",fn:function(){photo["delete"](t)}}];basicContext.show(o,e,contextMenu.close)},contextMenu.photoTitle=function(t,e,o){var n=[{type:"item",title:build.iconic("pencil")+"Rename",fn:function(){photo.setTitle([e])}}],i=album.json;i.content!==!1&&i.num>1&&(n.push({type:"separator"}),$.each(i.content,function(o){var i=this,a="";a="<img class='cover' width='16' height='16' src='"+i.thumbUrl+"'><div class='title'>"+i.title+"</div>",i.id!=e&&n.push({type:"item",title:a,fn:function(){lychee["goto"](t+"/"+i.id)}})})),basicContext.show(n,o,contextMenu.close)},contextMenu.photoMore=function(t,e){var o=[{type:"item",title:build.iconic("fullscreen-enter")+"Full Photo",fn:function(){window.open(photo.getDirectLink())}},{type:"item",title:build.iconic("cloud-download")+"Download",fn:function(){photo.getArchive(t)}}];album.json&&album.json.downloadable&&"1"===album.json.downloadable||lychee.publicMode!==!0||o.splice(1,1),basicContext.show(o,e)},contextMenu.move=function(t,e){var o=[];api.post("Album::getAll",{},function(n){0===n.num?o=[{type:"item",title:"New Album",fn:album.add}]:($.each(n.albums,function(e){var n=this;n.thumbs[0]||(n.thumbs[0]="src/images/no_cover.svg"),n.title="<img class='cover' width='16' height='16' src='"+n.thumbs[0]+"'><div class='title'>"+n.title+"</div>",n.id!=album.getID()&&o.push({type:"item",title:n.title,fn:function(){photo.setAlbum(t,n.id)}})}),"0"!==album.getID()&&(o.unshift({type:"separator"}),o.unshift({type:"item",title:"Unsorted",fn:function(){photo.setAlbum(t,0)}}))),basicContext.show(o,e,contextMenu.close)})},contextMenu.sharePhoto=function(t,e){var o=photo.getViewLink(t),n="ionicons";"2"===photo.json["public"]&&(o=location.href);var i=[{type:"item",title:'<input readonly id="link" value="'+o+'">',fn:function(){},"class":"noHover"},{type:"separator"},{type:"item",title:build.iconic("twitter",n)+"Twitter",fn:function(){photo.share(t,0)}},{type:"item",title:build.iconic("facebook",n)+"Facebook",fn:function(){photo.share(t,1)}},{type:"item",title:build.iconic("envelope-closed")+"Mail",fn:function(){photo.share(t,2)}},{type:"item",title:build.iconic("dropbox",n)+"Dropbox",fn:function(){photo.share(t,3)}},{type:"item",title:build.iconic("link-intact")+"Direct Link",fn:function(){window.open(photo.getDirectLink())}},{type:"separator"},{type:"item",title:build.iconic("ban")+"Make Private",fn:function(){photo.setPublic(t)}}];basicContext.show(i,e),$(".basicContext input#link").focus().select()},contextMenu.shareAlbum=function(t,e){var o="ionicons",n=[{type:"item",title:'<input readonly id="link" value="'+location.href+'">',fn:function(){},"class":"noHover"},{type:"separator"},{type:"item",title:build.iconic("twitter",o)+"Twitter",fn:function(){album.share(0);
}},{type:"item",title:build.iconic("facebook",o)+"Facebook",fn:function(){album.share(1)}},{type:"item",title:build.iconic("envelope-closed")+"Mail",fn:function(){album.share(2)}},{type:"separator"},{type:"item",title:build.iconic("pencil")+"Edit Sharing",fn:function(){album.setPublic(t,!0,e)}},{type:"item",title:build.iconic("ban")+"Make Private",fn:function(){album.setPublic(t,!1)}}];basicContext.show(n,e),$(".basicContext input#link").focus().select()},contextMenu.close=function(){return!!visible.contextMenu()&&(basicContext.close(),$(".photo.active, .album.active").removeClass("active"),void(visible.multiselect()&&multiselect.close()))},header={_dom:$("header")},header.dom=function(t){return void 0===t||null===t||""===t?header._dom:header._dom.find(t)},header.bind=function(){var t="ontouchend"in document.documentElement?"touchend":"click";return header.dom("#title").on(t,function(t){return!!$(this).hasClass("editable")&&void(visible.photo()?contextMenu.photoTitle(album.getID(),photo.getID(),t):contextMenu.albumTitle(album.getID(),t))}),header.dom("#button_share").on(t,function(t){"1"===photo.json["public"]||"2"===photo.json["public"]?contextMenu.sharePhoto(photo.getID(),t):photo.setPublic(photo.getID(),t)}),header.dom("#button_share_album").on(t,function(t){"1"===album.json["public"]?contextMenu.shareAlbum(album.getID(),t):album.setPublic(album.getID(),!0,t)}),header.dom("#button_signin").on(t,lychee.loginDialog),header.dom("#button_settings").on(t,contextMenu.settings),header.dom("#button_info_album").on(t,sidebar.toggle),header.dom("#button_info").on(t,sidebar.toggle),header.dom(".button_add").on(t,contextMenu.add),header.dom("#button_more").on(t,function(t){contextMenu.photoMore(photo.getID(),t)}),header.dom("#button_move").on(t,function(t){contextMenu.move([photo.getID()],t)}),header.dom("#hostedwith").on(t,function(){window.open(lychee.website)}),header.dom("#button_trash_album").on(t,function(){album["delete"]([album.getID()])}),header.dom("#button_trash").on(t,function(){photo["delete"]([photo.getID()])}),header.dom("#button_archive").on(t,function(){album.getArchive(album.getID())}),header.dom("#button_star").on(t,function(){photo.setStar([photo.getID()])}),header.dom("#button_back_home").on(t,function(){lychee["goto"]("")}),header.dom("#button_back").on(t,function(){lychee["goto"](album.getID())}),header.dom("#search").on("keyup click",function(){search.find($(this).val())}),header.dom("#clearSearch").on(t,function(){header.dom("#search").focus(),search.reset()}),!0},header.show=function(){var t=-1*($("#imageview #image").height()/2)+20;return clearTimeout($(window).data("timeout")),lychee.imageview.removeClass("full"),header.dom().removeClass("hidden"),$("#imageview #image.small").length>0?$("#imageview #image").css("margin-top",t):$("#imageview #image").removeClass("full"),!0},header.hide=function(t){var e=arguments.length<=1||void 0===arguments[1]?500:arguments[1];if(visible.photo()&&!visible.sidebar()&&!visible.contextMenu()&&!visible.message()){var o=-1*($("#imageview #image").height()/2);return clearTimeout($(window).data("timeout")),$(window).data("timeout",setTimeout(function(){lychee.imageview.addClass("full"),header.dom().addClass("hidden"),$("#imageview #image.small").length>0?$("#imageview #image").css("margin-top",o):$("#imageview #image").addClass("full")},e)),!0}return!1},header.setTitle=function(){var t=arguments.length<=0||void 0===arguments[0]?"Untitled":arguments[0],e=header.dom("#title");return e.html(t+build.iconic("caret-bottom")),!0},header.setMode=function(t){var e=album.getID();switch(t){case"albums":header.dom().removeClass("view"),$("#tools_album, #tools_photo").hide(),$("#tools_albums").show();try{var o=localStorage.getItem("lychee_role");"user"===o&&$("#tools_albums .button_add").hide()}catch(n){}return!0;case"album":header.dom().removeClass("view"),$("#tools_albums, #tools_photo").hide(),$("#tools_album").show(),album.json.content===!1?$("#button_archive").hide():$("#button_archive").show(),lychee.publicMode===!0&&"0"===album.json.downloadable&&$("#button_archive").hide(),console.log(album.json),"s"===e||"f"===e||"r"===e?$("#button_info_album, #button_trash_album, #button_share_album").hide():"0"===e?($("#button_info_album, #button_share_album").hide(),$("#button_trash_album").show()):$("#button_info_album, #button_trash_album, #button_share_album").show(),"1"===album.json.upload?$("#tools_album .button_add").show():$("#tools_album .button_add").hide(),"1"===album.json.erase?$("#tools_album #button_trash_album").show():$("#tools_album #button_trash_album").hide();try{var o=localStorage.getItem("lychee_role");"admin"===o&&$("#tools_album .button_add, #button_trash_album").show()}catch(n){}return!0;case"photo":return header.dom().addClass("view"),$("#tools_albums, #tools_album").hide(),$("#tools_photo").show(),!0}return!1},header.setEditable=function(t){var e=header.dom("#title");return lychee.publicMode===!0&&(t=!1),t?e.addClass("editable"):e.removeClass("editable"),!0},$(document).ready(function(){var t="ontouchend"in document.documentElement?"touchend":"click";api.onError=lychee.error,multiselect.bind(),header.bind(),lychee.imageview.on(t,".arrow_wrapper--previous",photo.previous).on(t,".arrow_wrapper--next",photo.next),Mousetrap.bind("left",function(){visible.photo()&&$("#imageview a#previous").click()}).bind("right",function(){visible.photo()&&$("#imageview a#next").click()}).bind("u",function(){$("#upload_files").click()}).bind(["s","f"],function(t){return visible.photo()?header.dom("#button_star").click():visible.albums()&&header.dom("#search").focus(),!1}).bind("r",function(t){t.preventDefault(),visible.album()?album.setTitle(album.getID()):visible.photo()&&photo.setTitle([photo.getID()])}).bind("d",function(t){t.preventDefault(),visible.photo()?photo.setDescription(photo.getID()):visible.album()&&album.setDescription(album.getID())}).bind("t",function(t){visible.photo()&&(t.preventDefault(),photo.editTags([photo.getID()]))}).bind("i",function(){return!visible.multiselect()&&void sidebar.toggle()}).bind(["command+backspace","ctrl+backspace"],function(){visible.photo()&&!visible.message()?photo["delete"]([photo.getID()]):visible.album()&&!visible.message()&&album["delete"]([album.getID()])}).bind(["command+a","ctrl+a"],function(){visible.album()&&!visible.message()?multiselect.selectAll():visible.albums()&&!visible.message()&&multiselect.selectAll()}),Mousetrap.bindGlobal("enter",function(){basicModal.visible()===!0&&basicModal.action()}),Mousetrap.bindGlobal(["esc","command+up"],function(t){t.preventDefault(),basicModal.visible()===!0?basicModal.cancel():visible.contextMenu()?contextMenu.close():visible.photo()?lychee["goto"](album.getID()):visible.album()?lychee["goto"](""):visible.albums()&&0!==$("#search").val().length&&search.reset()}),"ontouchend"in document.documentElement&&$(document).on("touchend","#image",function(t){(null===swipe.obj||swipe.offset>=-5&&swipe.offset<=5)&&(visible.header()?header.hide(t,0):header.show())}).swipe().on("swipeStart",function(){visible.photo()&&swipe.start($("#image"))}).swipe().on("swipeMove",function(t){visible.photo()&&swipe.move(t.swipe)}).swipe().on("swipeEnd",function(t){visible.photo()&&swipe.stop(t.swipe,photo.previous,photo.next)}),$(document).on("keyup","#password",function(){$(this).val().length>0&&$(this).removeClass("error")}).on("click",".album",function(){lychee["goto"]($(this).attr("data-id"))}).on("click",".photo",function(){lychee["goto"](album.getID()+"/"+$(this).attr("data-id"))}).on("contextmenu",".photo",function(t){contextMenu.photo(photo.getID(),t)}).on("contextmenu",".album",function(t){contextMenu.album(album.getID(),t)}).on("change","#upload_files",function(){basicModal.close(),upload.start.local(this.files)}).on("dragover",function(t){t.preventDefault()},!1).on("drop",function(t){return t.stopPropagation(),t.preventDefault(),visible.photo()&&lychee["goto"](album.getID()),visible.contextMenu()&&contextMenu.close(),t.originalEvent.dataTransfer.files.length>0?upload.start.local(t.originalEvent.dataTransfer.files):t.originalEvent.dataTransfer.getData("Text").length>3&&upload.start.url(t.originalEvent.dataTransfer.getData("Text")),!0}),lychee.init()}),loadingBar={status:null,_dom:$("#loading")},loadingBar.dom=function(t){return void 0===t||null===t||""===t?loadingBar._dom:loadingBar._dom.find(t)},loadingBar.show=function(t,e){return"error"===t?(loadingBar.status="error",e&&(e=e.replace("<br>","")),e||(e="Whoops, it looks like something went wrong. Please reload the site and try again!"),visible.header()&&header.dom().addClass("error"),loadingBar.dom().removeClass("loading uploading error").html("<h1>Error: <span>"+e+"</span></h1>").addClass(t).show(),clearTimeout(loadingBar._timeout),loadingBar._timeout=setTimeout(function(){loadingBar.hide(!0)},3e3),!0):null===loadingBar.status?(loadingBar.status="loading",clearTimeout(loadingBar._timeout),loadingBar._timeout=setTimeout(function(){visible.header()&&header.dom().addClass("loading"),loadingBar.dom().removeClass("loading uploading error").html("").addClass("loading").show()},1e3),!0):void 0},loadingBar.hide=function(t){("error"!==loadingBar.status&&null!==loadingBar.status||t)&&(loadingBar.status=null,header.dom().removeClass("error loading"),clearTimeout(loadingBar._timeout),setTimeout(function(){loadingBar.dom().hide()},300))},lychee={title:document.title,version:"3.0.2",version_code:"030002",update_path:"http://lychee.electerious.com/version/index.php",updateURL:"https://github.com/electerious/Lychee",website:"http://lychee.electerious.com",publicMode:!1,viewMode:!1,debugMode:!1,checkForUpdates:"1",sortingPhotos:"",sortingAlbums:"",location:"",dropbox:!1,dropboxKey:"",content:$("#content"),imageview:$("#imageview"),role:"guest"},lychee.init=function(){var t;t={version:lychee.version_code},api.post("Session::init",t,function(t){if(2===t.status){if(lychee.sortingPhotos=t.config.sortingPhotos||"",lychee.sortingAlbums=t.config.sortingAlbums||"",lychee.dropboxKey=t.config.dropboxKey||"",lychee.location=t.config.location||"",lychee.checkForUpdates=t.config.checkForUpdates||"1",lychee.role=null!==localStorage.getItem("lychee_role")?localStorage.getItem("lychee_role"):"guest",t.config.login===!1)return lychee.role="admin",void settings.createLogin()}else if(1===t.status)lychee.checkForUpdates=t.config.checkForUpdates||"1",lychee.setMode("public");else if(0===t.status)return lychee.setMode("public"),header.dom().hide(),lychee.content.hide(),$("body").append(build.no_content("cog")),settings.createConfig(),!0;$(window).bind("popstate",lychee.load),lychee.load()})},lychee.login=function(t){var e,o=t.username,n=t.password;e={user:o,password:n},api.post("Session::login",e,function(t){if(console.log(t),"false"!=t){try{localStorage.setItem("lychee_username",o),localStorage.setItem("lychee_role",t.role)}catch(e){}window.location.reload()}else basicModal.error("password")})},lychee.loginDialog=function(){var t,e="";e="\n\t\t\t<p class='signIn'>\n\t\t\t\t<input class='text' name='username' autocomplete='username' data-name='username' type='text' value='' placeholder='username' autocapitalize='off' autocorrect='off'>\n\t\t\t\t<input class='text' name='password' autocomplete='current-password' data-name='password' type='password' value='' placeholder='password'>\n\t\t\t</p>\n\t\t\t<p class='version'>Lychee "+lychee.version+"<span> &#8211; <a target='_blank' href='"+lychee.updateURL+"'>Update available!</a><span></p>\n\t\t\t",basicModal.show({body:e,buttons:{action:{title:"Sign In",fn:lychee.login},cancel:{title:"Cancel",fn:basicModal.close}}}),localStorage&&(t=localStorage.getItem("lychee_username"),null!==t&&(t.length>0&&$('.basicModal input[data-name="username"]').val(t),$('.basicModal input[data-name="password"]').focus())),"1"===lychee.checkForUpdates&&lychee.getUpdate()},lychee.logout=function(){localStorage.removeItem("lychee_role"),api.post("Session::logout",{},function(){window.location.reload()})},lychee["goto"]=function(t){t=void 0===t?"#":"#"+t,history.pushState(null,null,t),lychee.load()},lychee.load=function(){var t="",e="",o=document.location.hash.replace("#","").split("/");$(".no_content").remove(),contextMenu.close(),multiselect.close(),void 0!==o[0]&&(t=o[0]),void 0!==o[1]&&(e=o[1]),t&&e?(photo.json=null,(""===lychee.content.html()||$("#search").length&&0!==$("#search").val().length)&&(lychee.content.hide(),album.load(t,!0)),photo.load(e,t)):t?(photo.json=null,visible.sidebar()&&sidebar.toggle(),visible.photo()&&view.photo.hide(),album.json&&t==album.json.id?view.album.title():album.load(t)):(null!==search.hash&&(albums.json=null,search.hash=null),album.json=null,photo.json=null,visible.sidebar()&&sidebar.toggle(),visible.photo()&&view.photo.hide(),albums.load())},lychee.getUpdate=function(){$.ajax({url:lychee.update_path,success:function(t){parseInt(t)>parseInt(lychee.version_code)&&$(".version span").show()}})},lychee.setTitle=function(t,e){document.title=lychee.title+" - "+t,header.setEditable(e),header.setTitle(t)},lychee.setMode=function(t){$("#button_settings, #button_settings, #button_search, #search, #button_trash_album, #button_share_album, .button_add, .button_divider").remove(),$("#button_trash, #button_move, #button_share, #button_star").remove(),$(document).off("click","#title.editable").off("touchend","#title.editable").off("contextmenu",".photo").off("contextmenu",".album").off("drop"),Mousetrap.unbind("u").unbind("s").unbind("f").unbind("r").unbind("d").unbind("t").unbind(["command+backspace","ctrl+backspace"]).unbind(["command+a","ctrl+a"]),"public"===t?(header.dom("#button_signin, #hostedwith").show(),lychee.publicMode=!0):"view"===t&&(Mousetrap.unbind(["esc","command+up"]),$("#button_back, a#next, a#previous").remove(),$(".no_content").remove(),lychee.publicMode=!0,lychee.viewMode=!0)},lychee.animate=function(t,e){var o=[["fadeIn","fadeOut"],["contentZoomIn","contentZoomOut"]];t.jQuery||(t=$(t));for(var n=0;n<o.length;n++)for(var i=0;i<o[n].length;i++)if(o[n][i]==e)return t.removeClass(o[n][0]+" "+o[n][1]).addClass(e),!0;return!1},lychee.escapeHTML=function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},lychee.retinize=function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=window.devicePixelRatio,o=t.split(".").pop(),n="svg"!==o;return void 0!==e&&e>1&&n===!0&&(t=t.replace(/\.[^\/.]+$/,""),t=t+"@2x."+o),{path:t,hasRetina:n}},lychee.loadDropbox=function(t){if(!lychee.dropbox&&lychee.dropboxKey){loadingBar.show();var e=document.createElement("script"),o=document.getElementsByTagName("script")[0];e.src="https://www.dropbox.com/static/api/1/dropins.js",e.id="dropboxjs",e.type="text/javascript",e.async="true",e.setAttribute("data-app-key",lychee.dropboxKey),e.onload=e.onreadystatechange=function(){var e=this.readyState;e&&"complete"!==e&&"loaded"!==e||(lychee.dropbox=!0,loadingBar.hide(),t())},o.parentNode.insertBefore(e,o)}else lychee.dropbox&&lychee.dropboxKey?t():settings.setDropboxKey(t)},lychee.removeHTML=function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];if(""===t)return t;var e=document.createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText},lychee.error=function(t,e,o){console.error({description:t,params:e,response:o}),loadingBar.show("error",t)},multiselect={},multiselect.position={top:null,right:null,bottom:null,left:null},multiselect.bind=function(){return $("#content").on("mousedown",function(t){1===t.which&&multiselect.show(t)}),$(document).on("mouseup",function(t){1===t.which&&multiselect.getSelection(t)}),!0},multiselect.show=function(t){return!lychee.publicMode&&(!visible.search()&&(!(!visible.albums()&&!visible.album)&&(0===$(".album:hover, .photo:hover").length&&(visible.multiselect()&&$("#multiselect").remove(),sidebar.setSelectable(!1),multiselect.position.top=t.pageY,multiselect.position.right=-1*(t.pageX-$(document).width()),multiselect.position.bottom=-1*(multiselect.position.top-$(window).height()),multiselect.position.left=t.pageX,$("body").append(build.multiselect(multiselect.position.top,multiselect.position.left)),void $(document).on("mousemove",multiselect.resize)))))},multiselect.selectAll=function(){var t,e,o;return!lychee.publicMode&&(!visible.search()&&(!(!visible.albums()&&!visible.album)&&(visible.multiselect()&&$("#multiselect").remove(),sidebar.setSelectable(!1),multiselect.position.top=70,multiselect.position.right=40,multiselect.position.bottom=90,multiselect.position.left=20,$("body").append(build.multiselect(multiselect.position.top,multiselect.position.left)),e=$(document).width()-multiselect.position.right+2,o=$(document).height()-multiselect.position.bottom,$("#multiselect").css({width:e,height:o}),t={pageX:$(document).width()-multiselect.position.right/2,pageY:$(document).height()-multiselect.position.bottom},void multiselect.getSelection(t))))},multiselect.resize=function(t){var e,o,n=t.pageX,i=t.pageY;return null!==multiselect.position.top&&null!==multiselect.position.right&&null!==multiselect.position.bottom&&null!==multiselect.position.left&&(i>=multiselect.position.top?(e=i-multiselect.position.top,multiselect.position.top+e>=$(document).height()&&(e-=multiselect.position.top+e-$(document).height()+2),$("#multiselect").css({top:multiselect.position.top,bottom:"inherit",height:e})):$("#multiselect").css({top:"inherit",bottom:multiselect.position.bottom,height:multiselect.position.top-t.pageY}),void(n>=multiselect.position.left?(o=n-multiselect.position.left,multiselect.position.left+o>=$(document).width()&&(o-=multiselect.position.left+o-$(document).width()+2),$("#multiselect").css({right:"inherit",left:multiselect.position.left,width:o})):$("#multiselect").css({right:multiselect.position.right,left:"inherit",width:multiselect.position.left-t.pageX})))},multiselect.stopResize=function(){$(document).off("mousemove")},multiselect.getSize=function(){return!!visible.multiselect()&&{top:$("#multiselect").offset().top,left:$("#multiselect").offset().left,width:parseInt($("#multiselect").css("width").replace("px","")),height:parseInt($("#multiselect").css("height").replace("px",""))}},multiselect.getSelection=function(t){var e,o,n=150,i=[],a=multiselect.getSize();return!visible.contextMenu()&&(!!visible.multiselect()&&($(".photo, .album").each(function(){o=$(this).offset(),o.top>=a.top-n&&o.left>=a.left-n&&o.top+206<=a.top+a.height+n&&o.left+206<=a.left+a.width+n&&(e=$(this).data("id"),"0"!==e&&0!==e&&"f"!==e&&"s"!==e&&"r"!==e&&null!==e&&void 0!==e&&(i.push(e),$(this).addClass("active")))}),void(0!==i.length&&visible.album()?contextMenu.photoMulti(i,t):0!==i.length&&visible.albums()?contextMenu.albumMulti(i,t):multiselect.close())))},multiselect.close=function(){sidebar.setSelectable(!0),multiselect.stopResize(),multiselect.position.top=null,multiselect.position.right=null,multiselect.position.bottom=null,multiselect.position.left=null,lychee.animate("#multiselect","fadeOut"),setTimeout(function(){$("#multiselect").remove()},300)},password={value:""},password.get=function(t,e){var o,n=$(".basicModal input.text").val();lychee.publicMode===!1?e():album.json&&"0"===album.json.password?e():albums.json&&"0"===albums.getByID(t).password?e():albums.json||album.json?void 0==n?password.getDialog(t,e):(o={albumID:t,password:n},api.post("Album::getPublic",o,function(t){t===!0?(basicModal.close(),password.value=n,e()):basicModal.error("password")})):(album.json={password:!0},e(""))},password.getDialog=function(t,e){var o,n,i="";o=function(){password.get(t,e)},n=function(){basicModal.close(),visible.albums()===!1&&lychee["goto"]()},i="\n\t\t\t<p>\n\t\t\t\tThis album is protected by a password. Enter the password below to view the photos of this album:\n\t\t\t\t<input data-name='password' class='text' type='password' placeholder='password' value=''>\n\t\t\t</p>\n\t\t\t",basicModal.show({body:i,buttons:{action:{title:"Enter",fn:o},cancel:{title:"Cancel",fn:n}}})},photo={json:null,cache:null},photo.getID=function(){var t=null;return t=photo.json?photo.json.id:$(".photo:hover, .photo.active").attr("data-id"),$.isNumeric(t)===!0&&t},photo.getAlbumId=function(){var t=null;return t=photo.json?photo.json.albumid:$(".photo:hover, .photo.active").attr("data-album-id"),$.isNumeric(t)===!0&&t},photo.load=function(t,e){var o,n;o={photoID:t,albumID:e,password:password.value},api.post("Photo::get",o,function(o){return"Warning: Photo private!"===o?(lychee.content.show(),lychee["goto"](""),!1):"Warning: Wrong password!"===o?(n=function(){""!==password.value?photo.load(t,e):setTimeout(n,250)},n(),!1):(photo.json=o,visible.photo()||view.photo.show(),view.photo.init(),lychee.imageview.show(),void setTimeout(function(){lychee.content.show()},300))})},photo.preloadNext=function(t){var e,o;album.json&&album.json.content&&album.json.content[t]&&""!=album.json.content[t].nextPhoto&&(e=album.json.content[t].nextPhoto,o=album.json.content[e].url,photo.cache=new Image,photo.cache.src=o,photo.cache.onload=function(){photo.cache=null})},photo.parse=function(){photo.json.title||(photo.json.title="Untitled")},photo.previous=function(t){var e=0;photo.getID()!==!1&&album.json&&album.json.content[photo.getID()]&&""!==album.json.content[photo.getID()].previousPhoto&&(t===!0&&(e=200,$("#image").css({WebkitTransform:"translateX(100%)",MozTransform:"translateX(100%)",transform:"translateX(100%)",opacity:0})),setTimeout(function(){return photo.getID()!==!1&&void lychee["goto"](album.getID()+"/"+album.json.content[photo.getID()].previousPhoto)},e))},photo.next=function(t){var e=0;photo.getID()!==!1&&album.json&&album.json.content[photo.getID()]&&""!==album.json.content[photo.getID()].nextPhoto&&(t===!0&&(e=200,$("#image").css({WebkitTransform:"translateX(-100%)",MozTransform:"translateX(-100%)",transform:"translateX(-100%)",opacity:0})),setTimeout(function(){return photo.getID()!==!1&&void lychee["goto"](album.getID()+"/"+album.json.content[photo.getID()].nextPhoto)},e))},photo.duplicate=function(t){var e;return!!t&&(t instanceof Array==!1&&(t=[t]),albums.refresh(),e={photoIDs:t.join()},void api.post("Photo::duplicate",e,function(t){t!==!0?lychee.error(null,e,t):album.load(album.getID())}))},photo["delete"]=function(t){var e={},o={},n="",i="";return!!t&&(t instanceof Array==!1&&(t=[t]),1===t.length&&(i=visible.photo()?photo.json.title:album.json.content[t].title,""===i&&(i="Untitled")),e.fn=function(){var e="",o="",n="";basicModal.close(),t.forEach(function(t,e,i){""===album.json.content[t].nextPhoto&&""===album.json.content[t].previousPhoto||(o=album.json.content[t].nextPhoto,n=album.json.content[t].previousPhoto,album.json.content[n].nextPhoto=o,album.json.content[o].previousPhoto=n),delete album.json.content[t],view.album.content["delete"](t)}),albums.refresh(),visible.photo()&&""!==o&&o!==photo.getID()?lychee["goto"](album.getID()+"/"+o):visible.albums()||lychee["goto"](album.getID()),e={photoIDs:t.join()},api.post("Photo::delete",e,function(t){t!==!0&&lychee.error(null,e,t)})},1===t.length?(e.title="Delete Photo",o.title="Keep Photo",n="<p>Are you sure you want to delete the photo '"+i+"'? This action can't be undone!</p>"):(e.title="Delete Photo",o.title="Keep Photo",n="<p>Are you sure you want to delete all "+t.length+" selected photo? This action can't be undone!</p>"),void basicModal.show({body:n,buttons:{action:{title:e.title,fn:e.fn,"class":"red"},cancel:{title:o.title,fn:basicModal.close}}}))},photo.setTitle=function(t){var e,o="",n="",i="";return!!t&&(t instanceof Array==!1&&(t=[t]),1===t.length&&(photo.json?o=photo.json.title:album.json&&(o=album.json.content[t].title),o=o.replace(/'/g,"&apos;")),e=function(e){var o,n=e.title;basicModal.close(),n=lychee.removeHTML(n),visible.photo()&&(photo.json.title=""===n?"Untitled":n,view.photo.title()),t.forEach(function(t,e,o){album.json.content[t].title=n,view.album.content.title(t)}),o={photoIDs:t.join(),title:n},api.post("Photo::setTitle",o,function(t){t!==!0&&lychee.error(null,o,t)})},n="<input class='text' data-name='title' type='text' maxlength='50' placeholder='Title' value='"+o+"'>",i=1===t.length?"<p>Enter a new title for this photo: "+n+"</p>":"<p>Enter a title for all "+t.length+" selected photos: "+n+"</p>",void basicModal.show({body:i,buttons:{action:{title:"Set title",fn:e},cancel:{title:"Cancel",fn:basicModal.close}}}))},photo.setAlbum=function(t,e){var o,n,i;return!!t&&(visible.photo&&lychee["goto"](album.getID()),t instanceof Array==!1&&(t=[t]),t.forEach(function(t,e,o){""===album.json.content[t].nextPhoto&&""===album.json.content[t].previousPhoto||(n=album.json.content[t].nextPhoto,i=album.json.content[t].previousPhoto,album.json.content[i].nextPhoto=n,album.json.content[n].previousPhoto=i),album.json.content[t]=null,view.album.content["delete"](t)}),albums.refresh(),o={photoIDs:t.join(),albumID:e},void api.post("Photo::setAlbum",o,function(t){t!==!0&&lychee.error(null,o,t)}))},photo.setStar=function(t){var e;return!!t&&(visible.photo()&&(photo.json.star="0"===photo.json.star?"1":"0",view.photo.star()),t.forEach(function(t,e,o){album.json.content[t].star="0"===album.json.content[t].star?"1":"0",view.album.content.star(t)}),albums.refresh(),e={photoIDs:t.join()},void api.post("Photo::setStar",e,function(t){t!==!0&&lychee.error(null,e,t)}))},photo.setPublic=function(t,e){if("2"===photo.json["public"]){var o;return o=function(){basicModal.close(),lychee["goto"](photo.json.original_album)},basicModal.show({body:"<p>This photo is located in a public album. To make this photo private or public, edit the visibility of the associated album.</p>",buttons:{action:{title:"Show Album",fn:o},cancel:{title:"Cancel",fn:basicModal.close}}}),!1}visible.photo()&&(photo.json["public"]="0"===photo.json["public"]?"1":"0",view.photo["public"](),"1"===photo.json["public"]&&contextMenu.sharePhoto(t,e)),album.json.content[t]["public"]="0"===album.json.content[t]["public"]?"1":"0",view.album.content["public"](t),albums.refresh(),api.post("Photo::setPublic",{photoID:t},function(t){t!==!0&&lychee.error(null,params,t)})},photo.setDescription=function(t){var e,o=photo.json.description.replace(/'/g,"&apos;");e=function(e){var o,n=e.description;basicModal.close(),n=lychee.removeHTML(n),visible.photo()&&(photo.json.description=n,view.photo.description()),o={photoID:t,description:n},api.post("Photo::setDescription",o,function(t){t!==!0&&lychee.error(null,o,t)})},basicModal.show({body:"<p>Enter a description for this photo: <input class='text' data-name='description' type='text' maxlength='800' placeholder='Description' value='"+o+"'></p>",buttons:{action:{title:"Set Description",fn:e},cancel:{title:"Cancel",fn:basicModal.close}}})},photo.editTags=function(t){var e="",o="",n="";return!!t&&(t instanceof Array==!1&&(t=[t]),visible.photo()&&(e=photo.json.tags),visible.album()&&1===t.length&&(e=album.json.content[t].tags),visible.search()&&1===t.length&&(e=album.json.content[t].tags),visible.album()&&t.length>1&&!function(){var o=!0;t.forEach(function(e,n,i){o=album.json.content[e].tags===album.json.content[t[0]].tags&&o===!0}),o&&(e=album.json.content[t[0]].tags)}(),e=e.replace(/,/g,", "),action=function(e){basicModal.close(),photo.setTags(t,e.tags)},n="<input class='text' data-name='tags' type='text' maxlength='800' placeholder='Tags' value='"+e+"'>",o=1===t.length?"<p>Enter your tags for this photo. You can add multiple tags by separating them with a comma: "+n+"</p>":"<p>Enter your tags for all "+t.length+" selected photos. Existing tags will be overwritten. You can add multiple tags by separating them with a comma: "+n+"</p>",void basicModal.show({body:o,buttons:{action:{title:"Set Tags",fn:action},cancel:{title:"Cancel",fn:basicModal.close}}}))},photo.setTags=function(t,e){var o;return!!t&&(t instanceof Array==!1&&(t=[t]),e=e.replace(/(\ ,\ )|(\ ,)|(,\ )|(,{1,}\ {0,})|(,$|^,)/g,","),e=e.replace(/,$|^,|(\ ){0,}$/g,""),e=lychee.removeHTML(e),visible.photo()&&(photo.json.tags=e,view.photo.tags()),t.forEach(function(t,o,n){album.json.content[t].tags=e}),o={photoIDs:t.join(),tags:e},void api.post("Photo::setTags",o,function(t){t!==!0&&lychee.error(null,o,t)}))},photo.deleteTag=function(t,e){var o;o=photo.json.tags.split(","),o.splice(e,1),photo.json.tags=o.toString(),photo.setTags([t],photo.json.tags)},photo.share=function(t,e){var o="",n=photo.getViewLink(t),i="unknown";switch(e){case 0:o="https://twitter.com/share?url="+encodeURI(n);break;case 1:o="http://www.facebook.com/sharer.php?u="+encodeURI(n)+"&t="+encodeURI(photo.json.title);break;case 2:o="mailto:?subject="+encodeURI(photo.json.title)+"&body="+encodeURI(n);break;case 3:lychee.loadDropbox(function(){i=photo.json.title+"."+photo.getDirectLink().split(".").pop(),Dropbox.save(photo.getDirectLink(),i)});break;default:o=""}o.length>5&&(location.href=o)},photo.getSize=function(){var t="big",e=!1,o=""!==photo.json.medium,n=window.devicePixelRatio,i={width:$(window).width()-60,height:$(window).height()-100};return(photo.json.width>i.width||photo.json.height>i.height)&&(e=!0),void 0!==n&&n>1&&(i.width=i.width*n,i.height=i.height*n),o===!0&&1920>i.width&&1080>i.height&&(t="medium"),e===!1&&photo.json.width<i.width&&photo.json.width<i.height&&(t="small"),t},photo.getArchive=function(t){var e,o=api.path+"?function=Photo::getArchive&photoID="+t;e=location.href.indexOf("index.html")>0?location.href.replace(location.hash,"").replace("index.html",o):location.href.replace(location.hash,"")+o,lychee.publicMode===!0&&(e+="&password="+password.value),location.href=e},photo.getDirectLink=function(){var t="";return photo.json&&photo.json.url&&""!==photo.json.url&&(t=photo.json.url),t},photo.getViewLink=function(t){var e="view.php?p="+t;return location.href.indexOf("index.html")>0?location.href.replace("index.html"+location.hash,e):location.href.replace(location.hash,e)},search={hash:null},search.find=function(t){var e="",o="",n="";clearTimeout($(window).data("timeout")),$(window).data("timeout",setTimeout(function(){0!==$("#search").val().length?api.post("search",{term:t},function(t){t&&t.albums&&(albums.json={albums:t.albums},$.each(albums.json.albums,function(){albums.parse(this),e+=build.album(this)})),t&&t.photos&&(album.json={content:t.photos},$.each(album.json.content,function(){o+=build.photo(this)})),n=""===e&&""===o?"error":""===e?build.divider("Photos")+o:""===o?build.divider("Albums")+e:build.divider("Photos")+o+build.divider("Albums")+e,search.hash!==t.hash&&($(".no_content").remove(),lychee.animate("#content","contentZoomOut"),search.hash=t.hash,setTimeout(function(){"error"===n?(lychee.content.html(""),$("body").append(build.no_content("magnifying-glass"))):(lychee.content.html(n),lychee.animate("#content","contentZoomIn"))},300))}):search.reset()},250))},search.reset=function(){$("#search").val(""),$(".no_content").remove(),null!==search.hash&&(albums.json=null,album.json=null,photo.json=null,search.hash=null,lychee.animate(".divider","fadeOut"),albums.load())},settings={},settings.createConfig=function(){var t,e="";t=function(t){var e,o=t.dbName||"",n=t.dbUser||"",i=t.dbPassword||"",a=t.dbHost||"",l=t.dbTablePrefix||"";return n.length<1?(basicModal.error("dbUser"),!1):(a.length<1&&(a="localhost"),o.length<1&&(o="lychee"),e={dbName:o,dbUser:n,dbPassword:i,dbHost:a,dbTablePrefix:l},void api.post("Database::createConfig",e,function(t){return t!==!0?t.indexOf("Warning: Connection failed!")!==-1?(basicModal.show({body:"<p>Unable to connect to host database because access was denied. Double-check your host, username and password and ensure that access from your current location is permitted.</p>",buttons:{action:{title:"Retry",fn:settings.createConfig}}}),!1):t.indexOf("Warning: Creation failed!")!==-1?(basicModal.show({body:"<p>Unable to create the database. Double-check your host, username and password and ensure that the specified user has the rights to modify and add content to the database.</p>",buttons:{action:{title:"Retry",fn:settings.createConfig}}}),!1):t.indexOf("Warning: Could not create file!")!==-1?(basicModal.show({
body:"<p>Unable to save this configuration. Permission denied in <b>'data/'</b>. Please set the read, write and execute rights for others in <b>'data/'</b> and <b>'uploads/'</b>. Take a look at the readme for more information.</p>",buttons:{action:{title:"Retry",fn:settings.createConfig}}}),!1):(basicModal.show({body:"<p>Something unexpected happened. Please try again and check your installation and server. Take a look at the readme for more information.</p>",buttons:{action:{title:"Retry",fn:settings.createConfig}}}),!1):void window.location.reload()}))},e="\n\t\t\t<p>\n\t\t\t\tEnter your database connection details below:\n\t\t\t\t<input data-name='dbHost' class='text' type='text' placeholder='Database Host (optional)' value=''>\n\t\t\t\t<input data-name='dbUser' class='text' type='text' placeholder='Database Username' value=''>\n\t\t\t\t<input data-name='dbPassword' class='text' type='password' placeholder='Database Password' value=''>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tLychee will create its own database. If required, you can enter the name of an existing database instead:\n\t\t\t\t<input data-name='dbName' class='text' type='text' placeholder='Database Name (optional)' value=''>\n\t\t\t\t<input data-name='dbTablePrefix' class='text' type='text' placeholder='Table prefix (optional)' value=''>\n\t\t\t</p>\n\t\t\t",basicModal.show({body:e,buttons:{action:{title:"Connect",fn:t}}})},settings.createLogin=function(){var t,e="";t=function(t){var e,o=t.username,n=t.password;return o.length<1?(basicModal.error("username"),!1):n.length<1?(basicModal.error("password"),!1):(basicModal.close(),e={username:o,password:n},void api.post("Settings::setLogin",e,function(t){t!==!0?basicModal.show({body:"<p>Unable to save login. Please try again with another username and password!</p>",buttons:{action:{title:"Retry",fn:settings.createLogin}}}):lychee.load()}))},e="\n\t\t\t<p>\n\t\t\t\tEnter a username and password for your installation:\n\t\t\t\t<input data-name='username' class='text' type='text' placeholder='New Username' value=''>\n\t\t\t\t<input data-name='password' class='text' type='password' placeholder='New Password' value=''>\n\t\t\t</p>\n\t\t\t",basicModal.show({body:e,buttons:{action:{title:"Create Login",fn:t}}})},settings.setLogin=function(){var t,e="";t=function(t){var e,o=t.oldPassword||"",n=t.username||"",i=t.password||"";return o.length<1?(basicModal.error("oldPassword"),!1):n.length<1?(basicModal.error("username"),!1):i.length<1?(basicModal.error("password"),!1):(basicModal.close(),e={oldPassword:o,username:n,password:i},void api.post("Settings::setLogin",e,function(t){t!==!0&&lychee.error(null,e,t)}))},e="\n\t\t\t<p>\n\t\t\t\tEnter your current password:\n\t\t\t\t<input data-name='oldPassword' class='text' type='password' placeholder='Current Password' value=''>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tYour username and password will be changed to the following:\n\t\t\t\t<input data-name='username' class='text' type='text' placeholder='New Username' value=''>\n\t\t\t\t<input data-name='password' class='text' type='password' placeholder='New Password' value=''>\n\t\t\t</p>\n\t\t\t",basicModal.show({body:e,buttons:{action:{title:"Change Login",fn:t},cancel:{title:"Cancel",fn:basicModal.close}}})},settings.setSorting=function(){var t,e=[],o=[],n="";t=function(){var t;o[0]=$(".basicModal select#settings_albums_type").val(),o[1]=$(".basicModal select#settings_albums_order").val(),e[0]=$(".basicModal select#settings_photos_type").val(),e[1]=$(".basicModal select#settings_photos_order").val(),basicModal.close(),albums.refresh(),t={typeAlbums:o[0],orderAlbums:o[1],typePhotos:e[0],orderPhotos:e[1]},api.post("Settings::setSorting",t,function(n){n===!0?(lychee.sortingAlbums="ORDER BY "+o[0]+" "+o[1],lychee.sortingPhotos="ORDER BY "+e[0]+" "+e[1],lychee.load()):lychee.error(null,t,n)})},n="\n\t\t\t<p>\n\t\t\t\tSort albums by\n\t\t\t\t<span class=\"select\">\n\t\t\t\t\t<select id='settings_albums_type'>\n\t\t\t\t\t\t<option value='id'>Creation Time</option>\n\t\t\t\t\t\t<option value='title'>Title</option>\n\t\t\t\t\t\t<option value='description'>Description</option>\n\t\t\t\t\t\t<option value='public'>Public</option>\n\t\t\t\t\t</select>\n\t\t\t\t</span>\n\t\t\t\tin an\n\t\t\t\t<span class=\"select\">\n\t\t\t\t\t<select id='settings_albums_order'>\n\t\t\t\t\t\t<option value='ASC'>Ascending</option>\n\t\t\t\t\t\t<option value='DESC'>Descending</option>\n\t\t\t\t\t</select>\n\t\t\t\t</span>\n\t\t\t\torder.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tSort photos by\n\t\t\t\t<span class=\"select\">\n\t\t\t\t\t<select id='settings_photos_type'>\n\t\t\t\t\t\t<option value='id'>Upload Time</option>\n\t\t\t\t\t\t<option value='takestamp'>Take Date</option>\n\t\t\t\t\t\t<option value='title'>Title</option>\n\t\t\t\t\t\t<option value='description'>Description</option>\n\t\t\t\t\t\t<option value='public'>Public</option>\n\t\t\t\t\t\t<option value='star'>Star</option>\n\t\t\t\t\t\t<option value='type'>Photo Format</option>\n\t\t\t\t\t</select>\n\t\t\t\t</span>\n\t\t\t\tin an\n\t\t\t\t<span class=\"select\">\n\t\t\t\t\t<select id='settings_photos_order'>\n\t\t\t\t\t\t<option value='ASC'>Ascending</option>\n\t\t\t\t\t\t<option value='DESC'>Descending</option>\n\t\t\t\t\t</select>\n\t\t\t\t</span>\n\t\t\t\torder.\n\t\t\t</p>\n\t\t\t",basicModal.show({body:n,buttons:{action:{title:"Change Sorting",fn:t},cancel:{title:"Cancel",fn:basicModal.close}}}),""!==lychee.sortingAlbums&&(o=lychee.sortingAlbums.replace("ORDER BY ","").split(" "),$(".basicModal select#settings_albums_type").val(o[0]),$(".basicModal select#settings_albums_order").val(o[1])),""!==lychee.sortingPhotos&&(e=lychee.sortingPhotos.replace("ORDER BY ","").split(" "),$(".basicModal select#settings_photos_type").val(e[0]),$(".basicModal select#settings_photos_order").val(e[1]))},settings.setDropboxKey=function(t){var e,o="";e=function(e){var o=e.key;return e.key.length<1?(basicModal.error("key"),!1):(basicModal.close(),void api.post("Settings::setDropboxKey",{key:o},function(e){e===!0?(lychee.dropboxKey=o,t&&lychee.loadDropbox(t)):lychee.error(null,params,e)}))},o="\n\t\t\t<p>\n\t\t\t\tIn order to import photos from your Dropbox, you need a valid drop-ins app key from <a href='https://www.dropbox.com/developers/apps/create'>their website</a>. Generate yourself a personal key and enter it below:\n\t\t\t\t<input class='text' data-name='key' type='text' placeholder='Dropbox API Key' value='"+lychee.dropboxKey+"'>\n\t\t\t</p>\n\t\t\t",basicModal.show({body:o,buttons:{action:{title:"Set Dropbox Key",fn:e},cancel:{title:"Cancel",fn:basicModal.close}}})},sidebar={_dom:$("#sidebar"),types:{DEFAULT:0,TAGS:1},createStructure:{}},sidebar.dom=function(t){return void 0===t||null===t||""===t?sidebar._dom:sidebar._dom.find(t)},sidebar.bind=function(){var t="ontouchend"in document.documentElement?"touchend":"click";return sidebar.dom("#edit_title").off(t).on(t,function(){visible.photo()?photo.setTitle([photo.getID()]):visible.album()&&album.setTitle([album.getID()])}),sidebar.dom("#edit_description").off(t).on(t,function(){visible.photo()?photo.setDescription(photo.getID()):visible.album()&&album.setDescription(album.getID())}),sidebar.dom("#edit_tags").off(t).on(t,function(){photo.editTags([photo.getID()])}),sidebar.dom("#tags .tag span").off(t).on(t,function(){photo.deleteTag(photo.getID(),$(this).data("index"))}),!0},sidebar.toggle=function(){return!(!visible.sidebar()&&!visible.sidebarbutton())&&(header.dom(".button--info").toggleClass("active"),lychee.content.toggleClass("sidebar"),sidebar.dom().toggleClass("active"),!0)},sidebar.setSelectable=function(){var t=arguments.length<=0||void 0===arguments[0]||arguments[0];t===!0?sidebar.dom().removeClass("notSelectable"):sidebar.dom().addClass("notSelectable")},sidebar.changeAttr=function(t){var e=arguments.length<=1||void 0===arguments[1]?"-":arguments[1];return void 0!==t&&null!==t&&""!==t&&(""!==e&&null!==e||(e="-"),sidebar.dom(".attr_"+t).html(e),!0)},sidebar.createStructure.photo=function(t){if(void 0===t||null===t||""===t)return!1;var e=!1,o=t.takestamp+t.make+t.model+t.shutter+t.aperture+t.focal+t.iso,n={},i="";switch(lychee.publicMode===!1&&(e=!0),t["public"]){case"0":i="No";break;case"1":i="Yes";break;case"2":i="Yes (Album)";break;default:i="-"}return n.basics={title:"Basics",type:sidebar.types.DEFAULT,rows:[{title:"Title",value:t.title,editable:e},{title:"Uploaded",value:t.sysdate},{title:"Description",value:t.description,editable:e}]},n.image={title:"Image",type:sidebar.types.DEFAULT,rows:[{title:"Size",value:t.size},{title:"Format",value:t.type},{title:"Resolution",value:t.width+" x "+t.height}]},lychee.publicMode===!1?n.tags={title:"Tags",type:sidebar.types.TAGS,value:build.tags(t.tags),editable:e}:n.tags={},"0"!==o?n.exif={title:"Camera",type:sidebar.types.DEFAULT,rows:[{title:"Captured",value:t.takedate},{title:"Make",value:t.make},{title:"Type/Model",value:t.model},{title:"Shutter Speed",value:t.shutter},{title:"Aperture",value:t.aperture},{title:"Focal Length",value:t.focal},{title:"ISO",value:t.iso}]}:n.exif={},n.sharing={title:"Sharing",type:sidebar.types.DEFAULT,rows:[{title:"Public",value:i}]},n=[n.basics,n.image,n.tags,n.exif,n.sharing]},sidebar.createStructure.album=function(t){if(void 0===t||null===t||""===t)return!1;var e=!1,o={},n="",i="",a="",l="";switch(lychee.publicMode===!1&&"admin"===lychee.role&&(e=!0),t["public"]){case"0":n="No";break;case"1":n="Yes";break;default:n="-"}switch(t.visible){case"0":i="No";break;case"1":i="Yes";break;default:i="-"}switch(t.downloadable){case"0":a="No";break;case"1":a="Yes";break;default:a="-"}switch(t.password){case"0":l="No";break;case"1":l="Yes";break;default:l="-"}return o.basics={title:"Basics",type:sidebar.types.DEFAULT,rows:[{title:"Title",value:t.title,editable:e},{title:"Description",value:t.description,editable:e}]},o.album={title:"Album",type:sidebar.types.DEFAULT,rows:[{title:"Created",value:t.sysdate},{title:"Images",value:t.num}]},o.share={title:"Share",type:sidebar.types.DEFAULT,rows:[{title:"Public",value:n},{title:"Visible",value:i},{title:"Downloadable",value:a},{title:"Password",value:l}]},o=[o.basics,o.album,o.share]},sidebar.render=function(t){if(void 0===t||null===t||""===t)return!1;var e="",o=function(t){var e="";return e+="\n\t\t\t\t\t<div class='divider'>\n\t\t\t\t\t\t<h1>"+t.title+"</h1>\n\t\t\t\t\t</div>\n\t\t\t\t\t<table>\n\t\t\t\t\t",t.rows.forEach(function(t){var o=t.value;""!==o&&null!==o&&void 0!==o||(o="-"),o="<span class='attr_"+t.title.toLowerCase()+"'>"+o+"</span>",t.editable===!0&&(o+=" "+build.editIcon("edit_"+t.title.toLowerCase())),e+="\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>"+t.title+"</td>\n\t\t\t\t\t\t\t<td>"+o+"</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t"}),e+="\n\t\t\t\t\t</table>\n\t\t\t\t\t"},n=function(t){var e="";return e+="\n\t\t\t\t\t<div class='divider'>\n\t\t\t\t\t\t<h1>"+t.title+"</h1>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id='tags'>\n\t\t\t\t\t\t<div class='attr_"+t.title.toLowerCase()+"'>"+t.value+"</div>\n\t\t\t\t\t",t.editable===!0&&(e+=build.editIcon("edit_tags")),e+="\n\t\t\t\t\t</div>\n\t\t\t\t\t"};return t.forEach(function(t){t.type===sidebar.types.DEFAULT?e+=o(t):t.type===sidebar.types.TAGS&&(e+=n(t))}),e},swipe={obj:null,tolerance:150,offset:0},swipe.start=function(t,e){return t&&(swipe.obj=t),e&&(swipe.tolerance=e),!0},swipe.move=function(t){return null!==swipe.obj&&(swipe.offset=-1*t.x,void swipe.obj.css({WebkitTransform:"translateX("+swipe.offset+"px)",MozTransform:"translateX("+swipe.offset+"px)",transform:"translateX("+swipe.offset+"px)"}))},swipe.stop=function(t,e,o){t.x<=-swipe.tolerance?e(!0):t.x>=swipe.tolerance?o(!0):null!==swipe.obj&&swipe.obj.css({WebkitTransform:"translateX(0px)",MozTransform:"translateX(0px)",transform:"translateX(0px)"}),swipe.obj=null,swipe.offset=0},upload={},upload.show=function(t,e,o){basicModal.show({body:build.uploadModal(t,e),buttons:{action:{title:"Close","class":"hidden",fn:basicModal.close}},callback:o})},upload.notify=function(t,e){var o;return e&&""!==e||(e="You can now manage your new photo(s)."),!!window.webkitNotifications&&(0!==window.webkitNotifications.checkPermission()&&window.webkitNotifications.requestPermission(),void(0===window.webkitNotifications.checkPermission()&&t&&(o=window.webkitNotifications.createNotification("",t,e),o.show())))},upload.start={local:function(t){var e=album.getID(),o=!1,n=function a(t,n){var i=new FormData,l=new XMLHttpRequest,s=0,c=0,r=function(){window.onbeforeunload=null,$("#upload_files").val(""),o===!1?(basicModal.close(),upload.notify("Upload complete")):($(".basicModal #basicModal__action.hidden").show(),upload.notify("Upload complete","Failed to upload one or more photos.")),albums.refresh(),album.getID()===!1?lychee["goto"]("0"):album.load(e)};if(n.supported===!1){if(null!==n.next)a(t,n.next);else{for(var u=!1,d=0;d<t.length;d++)if(t[d].supported===!0){u=!0;break}u===!1&&setTimeout(r,2e3)}return!1}i.append("function","Photo::add"),i.append("albumID",e),i.append("tags",""),i.append(0,n),l.open("POST",api.path),l.onload=function(){var e=!1,i="";n.ready=!0,200===l.status&&"1"===l.responseText?$(".basicModal .rows .row:nth-child("+(n.num+1)+") .status").html("Finished").addClass("success"):($(".basicModal .rows .row:nth-child("+(n.num+1)+") .status").html("Error").addClass("error"),i="Error:"===l.responseText.substr(0,6)?l.responseText.substr(6)+" Please take a look at the console of your browser for further details.":"Server returned an unknown response. Please take a look at the console of your browser for further details.",$(".basicModal .rows .row:nth-child("+(n.num+1)+") p.notice").html(i).show(),o=!0,lychee.error("Upload failed. Server returned the status code "+l.status+"!",l,l.responseText));for(var a=0;a<t.length;a++)if(t[a].ready===!1){e=!0;break}e===!1&&r()},l.upload.onprogress=function(e){if(e.lengthComputable&&(c=e.loaded/e.total*100|0,c>s&&($(".basicModal .rows .row:nth-child("+(n.num+1)+") .status").html(c+"%"),s=c),c>=100)){var o=0;n.num+1>4&&(o=40*(n.num+1-4)),$(".basicModal .rows").scrollTop(o),$(".basicModal .rows .row:nth-child("+(n.num+1)+") .status").html("Processing"),null!==n.next&&a(t,n.next)}},l.send(i)};if(t.length<=0)return!1;e!==!1&&visible.albums()!==!0||(e=0);for(var i=0;i<t.length;i++)t[i].num=i,t[i].ready=!1,t[i].supported=!0,i<t.length-1?t[i].next=t[i+1]:t[i].next=null,"image/jpeg"!==t[i].type&&"image/jpg"!==t[i].type&&"image/png"!==t[i].type&&"image/gif"!==t[i].type&&(t[i].ready=!0,t[i].supported=!1);window.onbeforeunload=function(){return"Lychee is currently uploading!"},upload.show("Uploading",t,function(){n(t,t[0])})},url:function t(){var e,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],o=album.getID(),t="string"==typeof t?t:"";o===!1&&(o=0),e=function(t){var e,n=[];if(t.link&&t.link.length>3){if(basicModal.close(),e=t.link.split(".").pop(),"jpeg"!==e&&"jpg"!==e&&"png"!==e&&"gif"!==e&&"webp"!==e)return loadingBar.show("error","The file format of this link is not supported."),!1;n[0]={name:t.link,supported:!0},upload.show("Importing URL",n,function(){var e;$(".basicModal .rows .row .status").html("Importing"),e={url:t.link,albumID:o},api.post("Import::url",e,function(t){basicModal.close(),upload.notify("Import complete"),albums.refresh(),album.getID()===!1?lychee["goto"]("0"):album.load(o),t!==!0&&lychee.error(null,e,t)})})}else basicModal.error("link")},basicModal.show({body:"<p>Please enter the direct link to a photo to import it: <input class='text' data-name='link' type='text' placeholder='http://' value='"+t+"'></p>",buttons:{action:{title:"Import",fn:e},cancel:{title:"Cancel",fn:basicModal.close}}})},server:function(){var t,e=album.getID();e===!1&&(e=0),t=function(t){var o=[];o[0]={name:t.path,supported:!0},upload.show("Importing from server",o,function(){var o;$(".basicModal .rows .row .status").html("Importing"),o={albumID:e,path:t.path},api.post("Import::server",o,function(t){return basicModal.close(),upload.notify("Import complete"),albums.refresh(),"Notice: Import only contains albums!"===t?visible.albums()?lychee.load():lychee["goto"](""):album.getID()===!1?lychee["goto"]("0"):album.load(e),"Notice: Import only contains albums!"===t||void("Warning: Folder empty!"===t?lychee.error("Folder empty. No photos imported!",o,t):t!==!0&&lychee.error(null,o,t))})})},basicModal.show({body:"<p>This action will import all photos, folders and sub-folders which are located in the following directory. The <b>original files will be deleted</b> after the import when possible. <input class='text' data-name='path' type='text' maxlength='100' placeholder='Absolute path to directory' value='"+lychee.location+"uploads/import/'></p>",buttons:{action:{title:"Import",fn:t},cancel:{title:"Cancel",fn:basicModal.close}}})},dropbox:function(){var t,e=album.getID(),o="";e===!1&&(e=0),t=function(t){for(var n=0;n<t.length;n++)o+=t[n].link+",",t[n]={name:t[n].link,supported:!0};o=o.substr(0,o.length-1),upload.show("Importing from Dropbox",t,function(){var t;$(".basicModal .rows .row .status").html("Importing"),t={url:o,albumID:e},api.post("Import::url",t,function(o){basicModal.close(),upload.notify("Import complete"),albums.refresh(),album.getID()===!1?lychee["goto"]("0"):album.load(e),o!==!0&&lychee.error(null,t,o)})})},lychee.loadDropbox(function(){Dropbox.choose({linkType:"direct",multiselect:!0,success:t})})}},users={},users.addUser=function(){var t,e="";t=function(t){console.log(t);var e,o=t.username,n=t.password,i=$(".basicModal select#role").val();return o.length<1?(basicModal.error("username"),!1):n.length<1?(basicModal.error("password"),!1):(basicModal.close(),e={username:o,password:n,role:i},void api.post("Users::addUser",e,function(t){t!==!0?basicModal.show({body:"<p>Unable to create new user,</p>",buttons:{action:{title:"Retry",fn:users.addUser},cancel:{title:"Cancel",fn:basicModal.close}}}):users.manageUsers()}))},e="\n\t\t\t<p>\n\t\t\t\tEnter a username and password for the new user:\n\t\t\t\t<input data-name='username' class='text' type='text' placeholder='New Username' value=''>\n\t\t\t\t<input data-name='password' class='text' type='password' placeholder='New Password' value=''>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tRole:\n\t\t\t\t<span class=\"select\">\n\t\t\t\t\t<select id='role'>\n\t\t\t\t\t\t<option value='admin'>Admin</option>\n\t\t\t\t\t\t<option value='user'>User</option>\n\t\t\t\t\t</select>\n\t\t\t\t</span>\n\t\t\t</p>\n\t\t\t",basicModal.show({body:e,buttons:{action:{title:"Create User",fn:t},cancel:{title:"Cancel",fn:basicModal.close}}})},users.deleteUser=function(t){return!(t.length<1)&&(params={username:t},void api.post("Users::deleteUser",params,function(t){console.log(t),t!==!0?basicModal.show({body:"<p>Unable to delete user!</p>",buttons:{action:{title:"Close",fn:users.manageUsers}}}):users.manageUsers()}))},users.changePassword=function(){var t,e="";t=function(t){console.log(t);var e,o=t.oldPassword,n=t.newPassword,i=t.newPwRepeat;return o.length<1?(basicModal.error("oldPassword"),!1):n.length<1?(basicModal.error("newPassword"),!1):i.length<1?(basicModal.error("newPwRepeat"),!1):(basicModal.close(),e={oldPassword:o,newPassword:n,newPwRepeat:i},void api.post("Users::changePassword",e,function(t){t!==!0&&basicModal.show({body:"<p>Unable to save new password. Please try again</p>",buttons:{action:{title:"Retry",fn:users.changePassword},action:{title:"Close",fn:basicModal.close}}})}))},e="\n\t\t\t<p>\n\t\t\t\tEnter your old password and the new password:\n\t\t\t\t<input data-name='oldPassword' class='text' type='password' placeholder='Old Password' value=''>\n\t\t\t\t<input data-name='newPassword' class='text' type='password' placeholder='New Password' value=''>\n\t\t\t\t<input data-name='newPwRepeat' class='text' type='password' placeholder='Repeat new password' value=''>\n\t\t\t</p>\n\t\t\t",basicModal.show({body:e,buttons:{action:{title:"Change Password",fn:t},cancel:{title:"Cancel",fn:basicModal.close}}})},users.manageUsers=function(){api.post("Users::get","",function(t){if(t!==!0){var e=JSON.parse(t);basicModal.show({body:build.usersModal("Users",e),buttons:{action:{title:"Add User",fn:users.addUser},cancel:{title:"Close",fn:basicModal.close}}})}})},users.manageUser=function(t,e){var o={userid:e};api.post("Users::getPrivileges",o,function(o){o!==!0&&(console.log(o.albums),basicModal.show({body:build.userModal(t,e,JSON.parse(o)),buttons:{action:{title:"Back",fn:users.manageUsers}}}))})},users.changePrivileges=function(t,e,o,n){var n=n?"1":"0",i={userid:t,albumid:e,privilege:o,state:n};api.post("Users::changePrivileges",i,function(t){t!==!0?console.log("Failed to set privileges"):console.log("SEt privileges")})},view={},view.albums={init:function(){view.albums.title(),view.albums.content.init()},title:function(){lychee.setTitle("Albums",!1)},content:{scrollPosition:0,init:function(){var t="",e="";lychee.publicMode===!1&&(albums.parse(albums.json.smartalbums.unsorted),albums.parse(albums.json.smartalbums["public"]),albums.parse(albums.json.smartalbums.starred),albums.parse(albums.json.smartalbums.recent),t=build.divider("Smart Albums")+build.album(albums.json.smartalbums.unsorted)+build.album(albums.json.smartalbums["public"])+build.album(albums.json.smartalbums.starred)+build.album(albums.json.smartalbums.recent)),albums.json.albums&&0!==albums.json.num&&($.each(albums.json.albums,function(){albums.parse(this),e+=build.album(this)}),lychee.publicMode===!1&&(e=build.divider("Albums")+e)),""===t&&""===e?(lychee.content.html(""),$("body").append(build.no_content("eye"))):lychee.content.html(t+e),null!==view.albums.content.scrollPosition&&0!==view.albums.content.scrollPosition&&$(document).scrollTop(view.albums.content.scrollPosition)},title:function e(t){var e=albums.getByID(t).title;$('.album[data-id="'+t+'"] .overlay h1').html(e).attr("title",e)},"delete":function(t){$('.album[data-id="'+t+'"]').css("opacity",0).animate({width:0,marginLeft:0},300,function(){$(this).remove(),albums.json.num<=0&&lychee.content.find(".divider:last-child").remove()})}}},view.album={init:function(){album.parse(),view.album.sidebar(),view.album.title(),view.album["public"](),view.album.content.init(),album.json.init=1},title:function(){if((visible.album()||!album.json.init)&&!visible.photo())switch(album.getID()){case"f":lychee.setTitle("Starred",!1);break;case"s":lychee.setTitle("Public",!1);break;case"r":lychee.setTitle("Recent",!1);break;case"0":lychee.setTitle("Unsorted",!1);break;default:album.json.init&&sidebar.changeAttr("title",album.json.title),lychee.setTitle(album.json.title,!0)}},content:{init:function(){var t="";view.albums.content.scrollPosition=$(document).scrollTop(),$("html, body").scrollTop(0),album.json.content&&album.json.content!==!1&&$.each(album.json.content,function(){t+=build.photo(this)}),lychee.content.html(t)},title:function o(t){var o=album.json.content[t].title;$('.photo[data-id="'+t+'"] .overlay h1').html(o).attr("title",o)},star:function(t){$('.photo[data-id="'+t+'"] .iconic-star').remove(),"1"===album.json.content[t].star&&$('.photo[data-id="'+t+'"]').append("<a class='badge iconic-star'>"+build.iconic("star")+"</a>")},"public":function(t){$('.photo[data-id="'+t+'"] .iconic-share').remove(),"1"===album.json.content[t]["public"]&&$('.photo[data-id="'+t+'"]').append("<a class='badge iconic-share'>"+build.iconic("eye")+"</a>")},"delete":function(t){$('.photo[data-id="'+t+'"]').css("opacity",0).animate({width:0,marginLeft:0},300,function(){$(this).remove(),visible.albums()||(album.json.num--,view.album.num(),view.album.title())})}},description:function(){sidebar.changeAttr("description",album.json.description)},num:function(){sidebar.changeAttr("images",album.json.num)},"public":function(){"1"===album.json["public"]?($("#button_share_album").addClass("active").attr("title","Share Album"),$(".photo .iconic-share").remove(),album.json.init&&sidebar.changeAttr("public","Yes")):($("#button_share_album").removeClass("active").attr("title","Make Public"),album.json.init&&sidebar.changeAttr("public","No"))},visible:function(){"1"===album.json.visible?sidebar.changeAttr("visible","Yes"):sidebar.changeAttr("visible","No")},downloadable:function(){"1"===album.json.downloadable?sidebar.changeAttr("downloadable","Yes"):sidebar.changeAttr("downloadable","No")},password:function(){"1"===album.json.password?sidebar.changeAttr("password","Yes"):sidebar.changeAttr("password","No")},sidebar:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){if((visible.album()||!album.json.init)&&!visible.photo()){var t=sidebar.createStructure.album(album.json),e=sidebar.render(t);sidebar.dom(".wrapper").html(e),sidebar.bind()}})},view.photo={init:function(){photo.parse(),view.photo.sidebar(),view.photo.title(),view.photo.star(),view.photo["public"](),view.photo.photo(),photo.json.init=1},show:function(){lychee.content.addClass("view"),header.setMode("photo"),$("body").css("overflow","hidden"),$(document).bind("mouseenter",header.show).bind("mouseleave",header.hide),lychee.animate(lychee.imageview,"fadeIn")},hide:function(){header.show(),lychee.content.removeClass("view"),header.setMode("album"),$("body").css("overflow","auto"),$(document).unbind("mouseenter").unbind("mouseleave"),lychee.animate(lychee.imageview,"fadeOut"),setTimeout(function(){lychee.imageview.hide(),view.album.sidebar()},300)},title:function(){photo.json.init&&sidebar.changeAttr("title",photo.json.title),lychee.setTitle(photo.json.title,!0)},description:function(){photo.json.init&&sidebar.changeAttr("description",photo.json.description)},star:function(){1==photo.json.star?$("#button_star").addClass("active").attr("title","Unstar Photo"):($("#button_star").removeClass("active"),$("#button_star").attr("title","Star Photo"))},"public":function(){"1"===photo.json["public"]||"2"===photo.json["public"]?($("#button_share").addClass("active").attr("title","Share Photo"),photo.json.init&&sidebar.changeAttr("public","Yes")):($("#button_share").removeClass("active").attr("title","Make Public"),photo.json.init&&sidebar.changeAttr("public","No"))},tags:function(){sidebar.changeAttr("tags",build.tags(photo.json.tags)),sidebar.bind()},photo:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){lychee.imageview.html(build.imageview(photo.json,photo.getSize(),visible.header()));var t=lychee.imageview.find("a#next"),e=lychee.imageview.find("a#previous"),o=album.json&&album.json.content&&album.json.content[photo.getID()]&&""===album.json.content[photo.getID()].nextPhoto,n=album.json&&album.json.content&&album.json.content[photo.getID()]&&""===album.json.content[photo.getID()].previousPhoto;if(o||lychee.viewMode)t.hide();else{var i=album.json.content[photo.getID()].nextPhoto,a=album.json.content[i];t.css("background-image",'linear-gradient(to bottom, rgba(0, 0, 0, .4), rgba(0, 0, 0, .4)), url("'+a.thumbUrl+'")')}if(n||lychee.viewMode)e.hide();else{var l=album.json.content[photo.getID()].previousPhoto,s=album.json.content[l];e.css("background-image",'linear-gradient(to bottom, rgba(0, 0, 0, .4), rgba(0, 0, 0, .4)), url("'+s.thumbUrl+'")')}}),sidebar:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t=sidebar.createStructure.photo(photo.json),e=sidebar.render(t);sidebar.dom(".wrapper").html(e),sidebar.bind()})},visible={},visible.albums=function(){return"block"===$("#tools_albums").css("display")},visible.album=function(){return"block"===$("#tools_album").css("display")},visible.photo=function(){return $("#imageview.fadeIn").length>0},visible.search=function(){return null!==search.hash},visible.sidebar=function(){return sidebar.dom().hasClass("active")===!0},visible.sidebarbutton=function(){return!visible.albums()&&(!!visible.photo()||!!(visible.album()&&$("#button_info_album:visible").length>0))},visible.header=function(){return header.dom().hasClass("hidden")!==!0},visible.message=function(){return $(".message").length>0},visible.signin=function(){return $(".message .sign_in").length>0},visible.contextMenu=function(){return basicContext.visible()},visible.multiselect=function(){return $("#multiselect").length>0},function(t){var e=function(e){var o=this;this.el=t(e),this.pos={start:{x:0,y:0},end:{x:0,y:0}},this.startTime,e.on("touchstart",function(t){o.touchStart(t)}),e.on("touchmove",function(t){o.touchMove(t)}),e.on("touchend",function(t){o.swipeEnd()}),e.on("mousedown",function(t){o.mouseDown(t)})};e.prototype={touchStart:function(t){var e=t.originalEvent.touches[0];this.swipeStart(t,e.pageX,e.pageY)},touchMove:function(t){var e=t.originalEvent.touches[0];this.swipeMove(t,e.pageX,e.pageY)},mouseDown:function(t){var e=this;this.swipeStart(t,t.pageX,t.pageY),this.el.on("mousemove",function(t){e.mouseMove(t)}),this.el.on("mouseup",function(){e.mouseUp()})},mouseMove:function(t){this.swipeMove(t,t.pageX,t.pageY)},mouseUp:function(t){this.swipeEnd(t),this.el.off("mousemove"),this.el.off("mouseup")},swipeStart:function(t,e,o){this.pos.start.x=e,this.pos.start.y=o,this.pos.end.x=e,this.pos.end.y=o,this.startTime=(new Date).getTime(),this.trigger("swipeStart",t)},swipeMove:function(t,e,o){this.pos.end.x=e,this.pos.end.y=o,this.trigger("swipeMove",t)},swipeEnd:function(t){this.trigger("swipeEnd",t)},trigger:function(e,o){var n=this,i=t.Event(e),a=n.pos.start.x-n.pos.end.x,l=n.pos.end.y-n.pos.start.y,s=Math.atan2(l,a),c="up",r=Math.round(Math.sqrt(Math.pow(a,2)+Math.pow(l,2))),u=Math.round(180*s/Math.PI),d=Math.round(r/((new Date).getTime()-n.startTime)*1e3);u<0&&(u=360-Math.abs(u)),u<=45&&u>=0||u<=360&&u>=315?c="left":u>=135&&u<=225?c="right":u>45&&u<135&&(c="down"),i.originalEvent=o,i.swipe={x:a,y:l,direction:c,distance:r,angle:u,speed:d},t(n.el).trigger(i)}},t.fn.swipe=function(){new e(this);return this}}(jQuery);